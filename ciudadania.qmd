# Ciudadanía

```{r, echo=FALSE, include=FALSE}
pacman::p_load(dplyr, sjPlot, stargazer, kableExtra, texreg, haven, sjlabelled, ggplot2, ggtext, ggpubr)

load("input/data/proc/ola1.RData")




```

```{r, echo=FALSE, eval=TRUE}
#Base General con el cuestionario para estudiantes
#Codificamos los valores 99-88 como missing para todas las variables
proc_datos <- proc_datos %>% set_na(., na = c(99, 88))

for (i in names(dplyr::select(proc_datos, tidyselect::starts_with("p1_"), starts_with("p2_"), starts_with("p8_"), starts_with("p9_"), starts_with("p17_")))) {
  proc_datos[[i]] <- sjlabelled::set_labels(
    x = proc_datos[[i]],
    labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo")
  )
}


for (i in names(dplyr::select(proc_datos, tidyselect::starts_with("p10_")))) {
  proc_datos[[i]] <- sjlabelled::set_labels(
    x = proc_datos[[i]],
    labels = c("Nada importante", "Algo importante", "Importante", "Muy importante")
  )
}


for (i in names(dplyr::select(proc_datos, tidyselect::starts_with("p11_")))) {
  proc_datos[[i]] <- sjlabelled::set_labels(
    x = proc_datos[[i]],
    labels = c("Seguro no haré esto", "Tal vez haré esto", "Probablemente haré esto", "Seguro haré esto")
  )
}

for (i in names(dplyr::select(proc_datos, tidyselect::starts_with("p12_")))) {
  proc_datos[[i]] <- sjlabelled::set_labels(
    x = proc_datos[[i]],
    labels = c("Si", "No")
  )
}

for (i in names(dplyr::select(proc_datos, tidyselect::starts_with("p13_")))) {
  proc_datos[[i]] <- sjlabelled::set_labels(
    x = proc_datos[[i]],
    labels = c("Nunca", "Una vez al año", "Una vez al mes", "Semanalmente", "Todos los días")
  )
}


for (i in names(dplyr::select(proc_datos, tidyselect::starts_with("p18_")))) {
  proc_datos[[i]] <- sjlabelled::set_labels(
    x = proc_datos[[i]],
    labels = c("Nunca", "Casi nunca", "Casi siempre", "Siempre")
  )
}

```

La idea de ciudadanía se entiende a partir de dos dimensiones: cívica y civil. Esta se encuentra orientada a la idea de participación en la sociedad, en tanto aspectos políticos formales como proyectos colectivos de acción social y aspectos de convivencia que son entendidos como prosociales. Ambos tipos pretenden aportar a la cohesión de las sociedades cuando se ejerce dicha participación ciudadana. Así, esas características de participación se posicionan como un ideal normativo enmarcado en la idea de buena ciudadanía.

La escuela como espacio de socialización política aporta en dicha formación de ciudadanía en los estudiantes. Lo anterior, se produce a partir de los Planes de Formación Ciudadana que se encuentran presentes en los curriculos escolares de los establecimientos. Con ello, el aula y las prácticas pedagogicas son esenciales para la reproducción de las ideas de ciudadanía que refieren al funcionamiento de la sociedad y la democracia.

Adicionalmente, se reconoce otro espacio de socialización política y que se consolida como el primer momento en que los niños/as son socializados respecto a los criterios de buena ciudadanía: la familia. De ese modo, el hogar es fundamental como primer espacio de acercamiento a las ideas sobre la política.

Con aquello presente, este módulo se estrcutrará en cuatro grandes apartados: **Formación ciudadana en la escuela**, **Participación política**, **Buena ciudadanía** y **Relación con el adulto en el hogar**. Dentro de cada uno se presentarán diversas preguntas referidas a actitudes y participación para medir la ciudadanía en torno a las percepciones de los estudiantes sobre criterios posicionados a nivel del espacio escolar como en la sociedad.

## Formación ciudadana en la escuela

En este primer apartado se presentan dos secciones: percepción de importancia del establecimiento y dinámicas del proceso formativo por parte del docente en el aula.

### Percepción respecto a la importancia que le entrega la escuela

Esta sección presenta una pregunta inicial referida al involucramiento de la escuela con la Formación Ciudadana. En ese sentido, la pregunta alude a la importancia que los estudiantes consideran que le entrega el establecimiento a la educación cívica en el espacio escolar.

```{r, echo=FALSE}
school_ciudadania = round(prop.table(table(categorias=proc_datos$school_ciudadania)),2)
school_ciudadania = as.data.frame(school_ciudadania)
school_ciudadania$categorias <- factor(school_ciudadania$categorias, levels = c(1, 2, 3, 4), labels = c("Ninguna importancia", "Algo de importancia", "Mediana importancia", "Mucha importancia"))
plot_school_ciudadania_ES<-ggplot(school_ciudadania,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title= "Estudiantes")

```

```{r, echo=FALSE}
# dona curso: Básica

basica_school_ciudadania <- proc_datos %>% dplyr::filter(curso_estudiante=="Básica") %>% 
  dplyr::select(school_ciudadania) #se filtran valores para esa categoría del curso
  
basica_school_ciudadania = round(prop.table(table(categorias=basica_school_ciudadania$school_ciudadania)),2) #se crean variables 'categoria' y 'Freq' del objeto

basica_school_ciudadania = as.data.frame(basica_school_ciudadania) #convertimos el objeto en data.frame

#basica_esfuerzo <- factor(basica_esfuerzo$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo")) #por ahora lo saltaré

plot_basica_school_ciudadania<-ggplot(basica_school_ciudadania,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes de básica") #graficamos


# dona curso: Media

# categoría media
media_school_ciudadania <- proc_datos %>% filter(curso_estudiante=="Media") %>% 
  dplyr::select(school_ciudadania) 

media_school_ciudadania = round(prop.table(table(categorias=media_school_ciudadania$school_ciudadania)),2)  

media_school_ciudadania = as.data.frame(media_school_ciudadania)

plot_media_school_ciudadania<-ggplot(media_school_ciudadania,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes de media") 

```

```{r, echo=FALSE}
# grafico esfuerzo en la sociedad

# Combinar los gráficos
school_ciudadania_percep <- ggarrange(
  plot_school_ciudadania_ES,
  common.legend = TRUE, 
  ncol = 1, 
  legend = "none")

school_ciudadania_curso <- ggarrange(
   plot_basica_school_ciudadania, 
   plot_media_school_ciudadania,
  common.legend = TRUE, 
 ncol = 2, 
  legend = "none")

merit_social_esfuerzo_percep_final <- ggarrange(
  school_ciudadania_percep,
  school_ciudadania_curso,
  common.legend = TRUE, 
  nrow = 2, 
  legend = "bottom",
  legend.grob = get_legend(plot_school_ciudadania_ES, "bottom"))

# Agregar una etiqueta global centrada
final_plot21 <- annotate_figure(
  merit_social_esfuerzo_percep_final,
  top = text_grob(
    "Figura 2.1: ¿Cuánta importancia dirías tú que se le da a la Formación Ciudadana?",
    size = 12, 
    face = "italic", 
    color = "#8B7D7B",
    hjust = 0.5))


final_plot21
```

En general, los estudiantes consideran que se le da una mediana importancia a la Formación Ciudadana en la escuela. Particularmente los estudiantes de enseñanza báscia consideraque se le da más importnacia, contestando en un 29% que la escuela le entrega mucha importancia, encompración con los estudiantes de media (20%).

### En el espacio de clases

Las preguntas de esta sección se enfocan en la dinámica de interacción entre docente y estudiantes en el aula. Específicamente, estas son referidas al momento en que se discute un tema político y social durante la clase, aludiendo así al rol del docente en el proceso formativo.

```{r, echo=FALSE}
school_ciudadania_es = round(prop.table(table(categorias=proc_datos$school_ciudadania_es)),2)
school_ciudadania_es = as.data.frame(school_ciudadania_es)
school_ciudadania_es$categorias <- factor(school_ciudadania_es$categorias, levels = c(1, 2, 3, 4), labels = c("Nunca", "Casi nunca", "Casi siempre", "Siempre"))
plot_school_ciudadania_es<-ggplot(school_ciudadania_es,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=9, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title= "Los estudiantes pueden\nmanifestar abiertamente su desacuerdo\ncon sus profesores(as)")


school_ciudadania_op = round(prop.table(table(categorias=proc_datos$school_ciudadania_op)),2)
school_ciudadania_op = as.data.frame(school_ciudadania_op)
school_ciudadania_op$categorias <- factor(school_ciudadania_op$categorias, levels = c(1, 2, 3, 4), labels = c("Nunca", "Casi nunca", "Casi siempre", "Siempre"))
plot_school_ciudadania_op<-ggplot(school_ciudadania_op,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=9, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title= "Los(as) profesores(as) estimulan\na los estudiantes a expresar\nsus opiniones")


school_ciudadania_dif = round(prop.table(table(categorias=proc_datos$school_ciudadania_dif)),2)
school_ciudadania_dif = as.data.frame(school_ciudadania_dif)
school_ciudadania_dif$categorias <- factor(school_ciudadania_dif$categorias, levels = c(1, 2, 3, 4), labels = c("Nunca", "Casi nunca", "Casi siempre", "Siempre"))
plot_school_ciudadania_dif<-ggplot(school_ciudadania_dif,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=9, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title= "Los(as) profesores(as) estimulan\na los estudiantes a conversar los temas\ncon gente que opina distinto")

school_ciudadania_class = round(prop.table(table(categorias=proc_datos$school_ciudadania_class)),2)
school_ciudadania_class = as.data.frame(school_ciudadania_class)
school_ciudadania_class$categorias <- factor(school_ciudadania_class$categorias, levels = c(1, 2, 3, 4), labels = c("Nunca", "Casi nunca", "Casi siempre", "Siempre"))
plot_school_ciudadania_class<-ggplot(school_ciudadania_class,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=9, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title= "Los(as) profesores(as) exponen\nlos temas desde distintos enfoques\nal explicarlos en clases")

p18_3 = round(prop.table(table(categorias=proc_datos$p18_3)),2)
p18_3 = as.data.frame(p18_3)
p18_3$categorias <- factor(p18_3$categorias, levels = c(1, 2, 3, 4), labels = c("Nunca", "Casi nunca", "Casi siempre", "Siempre"))
plot_p18_3<-ggplot(p18_3,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=9, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title= "Los estudiantes plantean\nhechos políticos de actualidad para\nser discutidos en clases")
```

```{r, echo=FALSE}
# Combinar los gráficos
plot_clases1 <- ggarrange(
   plot_school_ciudadania_es,
plot_school_ciudadania_op, 
common.legend = TRUE,
  ncol = 2, 
legend = "none")

plot_clases2 <- ggarrange(
   plot_p18_3,
plot_school_ciudadania_dif,
plot_school_ciudadania_class,
common.legend = TRUE,
  ncol = 3, 
legend = "none")

plot_clases_final <- ggarrange(
  plot_clases1,
  plot_clases2,                                 
  common.legend = TRUE, 
  nrow = 2, 
  legend = "bottom",
  legend.grob = get_legend(plot_school_ciudadania_es, "bottom"))

# Agregar una etiqueta global centrada
plot_class <- annotate_figure(
 plot_clases_final ,
  top = text_grob(
    "Figura 2.2: Durante una discusión de temas políticos y sociales\ndurante clases",
    size = 12, 
    face = "italic", 
    color = "#8B7D7B",
    hjust = 0.5
  )
)

plot_class
```

En general, las prácticas descritas se dan casi siempre, exceptuando la dinámica en que los estudiantes plantean hechos políticos de actualidad para discutir en la clase. En esa última, predomina la categoría casi nunca con un 36%. Así, se tiene un espacio de interacción entre docente y estudiantes, en donde los estudiantes casi siempre (42%) pueden manifestar abiertamente su desacuerdo con sus profesores(as) y los(as) profesores(as) estimulan siempre (42%) la expresión de las propias opiniones de los estudintes y casi siempre (42%) la conversación de estos mismos con gente que opina disntinto. Además, los estudiantes reconocen que sus profesores(as) exponen los temas desde distintos enfouqes en su explicación durante la clase, de ese modo contestaron en un 30% que siempre se realizaba dicha acción y en un 48% que se cumplía casi siempre.

## Participación política

La participación política se distingue en dos expresiones generales: cívica o formal y civil o prosocial/comunitaria. Asimismo, la participación de los estudiantes se puede distinguir de forma temporal, en tanto cómo se produce está en la actualidad y cuáles son sus expectativas de participación en el futuro. Es por ello, que se dividirá en dos grandes secciones: participación política actual y participación política futura. Además, dentro de cada una se distinguirá su expresión de participación.

### Participación politica actual

En esta sección se evidencian preguntas referentes a la participación política de los estudiantes en el presente escolar. De modo general, se presenta un apartado referido a la percepción de autoeficacia política que estos tienen (es decir, su participación efectiva) y preguntas referidas a su participación civil o prosocial. Respecto a estas últimas se distinguen dos figuras: participación civil tradicional y en Internet.

**Autoeficacia política**:

```{r, echo=FALSE}

pp_presente_pol = round(prop.table(table(categorias=proc_datos$pp_presente_pol)),2)
pp_presente_pol = as.data.frame(pp_presente_pol)
pp_presente_pol$categorias <- factor(pp_presente_pol$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo"))
plot_pp_presente_pol_ES<-ggplot(pp_presente_pol,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes")


```

```{r, echo=FALSE}

# dona genero: Mujer

basica_pp_presente_pol <- proc_datos %>% dplyr::filter(curso_estudiante=="Básica") %>% 
  dplyr::select(pp_presente_pol) #se filtran valores para esa categoría del curso
  
basica_pp_presente_pol = round(prop.table(table(categorias=basica_pp_presente_pol$pp_presente_pol)),2) #se crean variables 'categoria' y 'Freq' del objeto

basica_pp_presente_pol = as.data.frame(basica_pp_presente_pol) #convertimos el objeto en data.frame

#basica_esfuerzo <- factor(basica_esfuerzo$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo")) #por ahora lo saltaré

plot_basica_pp_presente_pol<-ggplot(basica_pp_presente_pol,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiante de básica") #graficamos


# dona curso: Media

# categoría media
media_pp_presente_pol <- proc_datos %>% filter(curso_estudiante=="Media") %>% 
  dplyr::select(pp_presente_pol) 

media_pp_presente_pol = round(prop.table(table(categorias=media_pp_presente_pol$pp_presente_pol)),2)  

media_pp_presente_pol = as.data.frame(media_pp_presente_pol)

plot_media_pp_presente_pol<-ggplot(media_pp_presente_pol,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiante de media") 
```

```{r, echo=FALSE}
# Combinar los gráficos
plot_pp_presente_pol_curso <- ggarrange(
   plot_basica_pp_presente_pol,
plot_media_pp_presente_pol, 
common.legend = TRUE,
  ncol = 2, 
legend = "none")


plot_pp_presente_pol_final <- ggarrange(
  plot_pp_presente_pol_ES,
  plot_pp_presente_pol_curso,                                 
  common.legend = TRUE, 
  nrow = 2, 
  legend = "bottom",
  legend.grob = get_legend(plot_pp_presente_pol_ES, "bottom"))

# Agregar una etiqueta global centrada
pp_presente <- annotate_figure(
 plot_pp_presente_pol_final ,
  top = text_grob(
    "Figura 2.3: Comprendo bien las problemáticas políticas de nuestro país",
    size = 12, 
    face = "italic", 
    color = "#8B7D7B",
    hjust = 0.5
  )
)

pp_presente
```

A modo general se observa que los

*Cruce con otras características sociodemográficas del estudiante*

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(dplyr)
library(tidyr)
library(ggplot2)
library(stringr)

# Calcular las frecuencias originales
frecuencias_originales <- proc_datos %>%
  pivot_longer(cols = c(genero_ES, educ_max, libros_hogar),
               names_to = "variable",
               values_to = "categoria") %>%
  group_by(variable, categoria) %>%
  summarise(Freq_Original = n(), .groups = 'drop')

# Combinar las frecuencias originales con la base transformada
proc_datos_largo <- proc_datos %>%
  pivot_longer(cols = c(genero_ES, educ_max, libros_hogar),
               names_to = "variable",
               values_to = "categoria")

frecuencias <- proc_datos_largo %>%
  group_by(variable, categoria, pp_presente_pol) %>%
  summarise(Freq = n(), .groups = 'drop') %>%
  left_join(frecuencias_originales, by = c("variable", "categoria")) %>%
  mutate(Porcentaje = Freq / Freq_Original) %>%
  ungroup() %>% 
  na.omit()
# nombre facet_wrap
variable_names <- list("educ_max" = "Nivel educacional de los padres",
                       "genero_ES" = "Género",
                       "libros_hogar" = "Cantidad de libros en el hogar")
variable_labeller <- function(variable, value){return(variable_names[value])}

# Ajustar las etiquetas largas
frecuencias$categoria <- str_wrap(frecuencias$categoria, width = 10)

# Crear la gráfica
ggplot(frecuencias, aes(x = categoria, y = Porcentaje, fill = factor(pp_presente_pol))) +
  geom_bar(stat = "identity", position = "fill", color = "white") +
  facet_wrap(~ variable, scales = "free_x", labeller = as_labeller(variable_labeller)) +
  geom_text(aes(label = scales::percent(Porcentaje, accuracy = 1)), 
            position = position_stack(vjust = 0.5), color = "black", size = 4.5) +
  labs(
    x = NULL, # Elimina el título del eje x
    y = NULL, # Elimina el título del eje y
    fill = "Grado de acuerdo",
    title = "Figura 2.4: Comprendo bien las problemáticas políticas de nuestro país"
  ) +
  theme_blank() +
  theme(
    axis.text.y = element_blank(),  # Ocultar etiquetas del eje y
    axis.ticks.y = element_blank(), # Ocultar marcas del eje y
    axis.title.x = element_blank(), # Ocultar título del eje x
    axis.title.y = element_blank(), # Ocultar título del eje y
    strip.text = element_text(size = 9, face = "bold"), # Ajustar tamaño y estilo del título de las facetas
    axis.text.x = element_text(size = 9), # Ajustar el tamaño de las etiquetas del eje x
    legend.position = "bottom",# Colocar la leyenda en la parte inferior
     plot.title = element_text(size = 12, face = "italic", color = "#8B7D7B")
  ) +
  scale_fill_brewer(palette = "Blues", 
                    labels = c("1" = "Muy en desacuerdo", "2" = "En desacuerdo", 
                               "3" = "De acuerdo", "4" = "Muy de acuerdo"),
                    name = NULL)
```

Participación política **civil** o **prosocial**:

-   Participación civil tradicional

```{r, echo=FALSE}
pp_presente_marcha = round(prop.table(table(categorias=proc_datos$pp_presente_marcha)),2)
pp_presente_marcha = as.data.frame(pp_presente_marcha)
pp_presente_marcha$categorias <- factor(pp_presente_marcha$categorias, levels = c(1, 2), labels = c("Sí", "No"))
plot_presente_marcha_ES<-ggplot(pp_presente_marcha,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Marcha pacífica")

pp_presente_toma = round(prop.table(table(categorias=proc_datos$pp_presente_toma)),2)
pp_presente_toma = as.data.frame(pp_presente_toma)
pp_presente_toma$categorias <- factor(pp_presente_toma$categorias, levels = c(1, 2), labels = c("Sí", "No"))
plot_presente_toma_ES<-ggplot(pp_presente_toma,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Toma")

pp_presente_rrss = round(prop.table(table(categorias=proc_datos$pp_presente_rrss)),2)
pp_presente_rrss = as.data.frame(pp_presente_rrss)
pp_presente_rrss$categorias <- factor(pp_presente_rrss$categorias, levels = c(1, 2, 3, 4,5), labels = c("Nunca", "Una vez al año", "Una vez al mes", "Semanalmente", "Todos los días"))
plot_presente_rrss_ES<-ggplot(pp_presente_rrss,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Informarse en Redes Sociales")

pp_presente_like = round(prop.table(table(categorias=proc_datos$pp_presente_like)),2)
pp_presente_like = as.data.frame(pp_presente_like)
pp_presente_like$categorias <- factor(pp_presente_like$categorias, levels = c(1, 2, 3, 4,5), labels = c("Nunca", "Una vez al año", "Una vez al mes", "Semanalmente", "Todos los días"))
plot_presente_like_ES<-ggplot(pp_presente_like,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Dar me gusta a contenido")

pp_presente_compartir = round(prop.table(table(categorias=proc_datos$pp_presente_compartir)),2)
pp_presente_compartir = as.data.frame(pp_presente_compartir)
pp_presente_compartir$categorias <- factor(pp_presente_compartir$categorias, levels = c(1, 2, 3, 4,5), labels = c("Nunca", "Una vez al año", "Una vez al mes", "Semanalmente", "Todos los días"))
plot_presente_compartir_ES<-ggplot(pp_presente_compartir,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Compartir contenido")

p12_2 = round(prop.table(table(categorias=proc_datos$p12_2)),2)
p12_2 = as.data.frame(p12_2)
p12_2$categorias <- factor(p12_2$categorias, levels = c(1, 2), labels = c("Sí", "No"))
plot_p12_2_ES<-ggplot(p12_2,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Marcha violenta")

p13_1 = round(prop.table(table(categorias=proc_datos$p13_1)),2)
p13_1 = as.data.frame(p13_1)
p13_1$categorias <- factor(p13_1$categorias, levels = c(1, 2, 3, 4,5), labels = c("Nunca", "Una vez al año", "Una vez al mes", "Semanalmente", "Todos los días"))
plot_p13_1_ES<-ggplot(p13_1,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Ver un Sitio Web")

p13_5 = round(prop.table(table(categorias=proc_datos$p13_5)),2)
p13_5 = as.data.frame(p13_5)
p13_5$categorias <- factor(p13_5$categorias, levels = c(1, 2, 3, 4,5), labels = c("Nunca", "Una vez al año", "Una vez al mes", "Semanalmente", "Todos los días"))
plot_p13_5_ES<-ggplot(p13_5,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Comentar una publicación")

```

```{r, echo=FALSE}
# Combinar los gráficos
pp_civil_ES <- ggarrange(
   plot_p12_2_ES, 
   plot_presente_toma_ES, 
   plot_presente_marcha_ES,
   
  common.legend = TRUE, 
  ncol = 3, 
  legend = "bottom"
)

# Agregar una etiqueta global centrada
o <- annotate_figure(
 pp_civil_ES ,
  top = text_grob(
    "Figura 2.5: ¿Has realizado algunas de las siguientes\nactividades durante los últimos 12 meses?",
    size = 12, 
    face = "italic", 
    color = "#8B7D7B",
    hjust = 0.5
  )
)

o
```

*Cruce con características sociodemográficas del estudiante*

-   Marcha violenta

```{r, echo=FALSE, message=FALSE, warning=FALSE}

 #Calcular las frecuencias originales
frecuencias_originales <- proc_datos %>%
  pivot_longer(cols = c(genero_ES, educ_max, libros_hogar, curso_estudiante),
               names_to = "variable",
               values_to = "categoria") %>%
  group_by(variable, categoria) %>%
  summarise(Freq_Original = n(), .groups = 'drop')

# Combinar las frecuencias originales con la base transformada
proc_datos_largo <- proc_datos %>%
  pivot_longer(cols = c(genero_ES, educ_max, libros_hogar, curso_estudiante),
               names_to = "variable",
               values_to = "categoria")
frecuencias <- proc_datos_largo %>%
  group_by(variable, categoria, p12_2) %>%
  summarise(Freq = n(), .groups = 'drop') %>%
  left_join(frecuencias_originales, by = c("variable", "categoria")) %>%
  mutate(Porcentaje = Freq / Freq_Original) %>%
  ungroup() %>% 
  na.omit()
# nombre facet_wrap
variable_names <- list("curso_estudiante" = "Curso",
                       "educ_max" = "Nivel educacional de los padres",
                       "genero_ES" = "Género",
                       "libros_hogar" = "Cantidad de libros en el hogar"
                       )
variable_labeller <- function(variable, value){return(variable_names[value])}

# Ajustar las etiquetas largas
frecuencias$categoria <- str_wrap(frecuencias$categoria, width = 10)

# Crear la gráfica
ggplot(frecuencias, aes(x = categoria, y = Porcentaje, fill = factor(p12_2))) +
  geom_bar(stat = "identity", position = "fill", color = "white") +
  facet_wrap(~ variable, scales = "free_x", labeller = as_labeller(variable_labeller)) +
  geom_text(aes(label = scales::percent(Porcentaje, accuracy = 1)), 
            position = position_stack(vjust = 0.5), color = "black", size = 4.5) +
  labs(
    x = NULL, # Elimina el título del eje x
    y = NULL, # Elimina el título del eje y
    fill = "Grado de acuerdo",
    title = "Figura 2.4: Participación en una marcha violenta en los últimos 12 meses"
  ) +
  theme_blank() +
  theme(
    axis.text.y = element_blank(),  # Ocultar etiquetas del eje y
    axis.ticks.y = element_blank(), # Ocultar marcas del eje y
    axis.title.x = element_blank(), # Ocultar título del eje x
    axis.title.y = element_blank(), # Ocultar título del eje y
    strip.text = element_text(size = 9, face = "bold"), # Ajustar tamaño y estilo del título de las facetas
    axis.text.x = element_text(size = 9), # Ajustar el tamaño de las etiquetas del eje x
    legend.position = "bottom",# Colocar la leyenda en la parte inferior
     plot.title = element_text(size = 12, face = "italic", color = "#8B7D7B")
  ) +
  scale_fill_brewer(palette = "Blues", 
                    labels = c("1" = "Sí", "2" = "No"),
                    name = NULL)
```

-   Toma

```{r, echo=FALSE}

 #Calcular las frecuencias originales
frecuencias_originales <- proc_datos %>%
  pivot_longer(cols = c(genero_ES, educ_max, libros_hogar, curso_estudiante),
               names_to = "variable",
               values_to = "categoria") %>%
  group_by(variable, categoria) %>%
  summarise(Freq_Original = n(), .groups = 'drop')

# Combinar las frecuencias originales con la base transformada
proc_datos_largo <- proc_datos %>%
  pivot_longer(cols = c(genero_ES, educ_max, libros_hogar, curso_estudiante),
               names_to = "variable",
               values_to = "categoria")
frecuencias <- proc_datos_largo %>%
  group_by(variable, categoria, pp_presente_toma) %>%
  summarise(Freq = n(), .groups = 'drop') %>%
  left_join(frecuencias_originales, by = c("variable", "categoria")) %>%
  mutate(Porcentaje = Freq / Freq_Original) %>%
  ungroup() %>% 
  na.omit()
# nombre facet_wrap
variable_names <- list("curso_estudiante" = "Curso",
                       "educ_max" = "Nivel educacional de los padres",
                       "genero_ES" = "Género",
                       "libros_hogar" = "Cantidad de libros en el hogar"
                       )
variable_labeller <- function(variable, value){return(variable_names[value])}

# Ajustar las etiquetas largas
frecuencias$categoria <- str_wrap(frecuencias$categoria, width = 10)

# Crear la gráfica
ggplot(frecuencias, aes(x = categoria, y = Porcentaje, fill = factor(pp_presente_toma))) +
  geom_bar(stat = "identity", position = "fill", color = "white") +
  facet_wrap(~ variable, scales = "free_x", labeller = as_labeller(variable_labeller)) +
  geom_text(aes(label = scales::percent(Porcentaje, accuracy = 1)), 
            position = position_stack(vjust = 0.5), color = "black", size = 4.5) +
  labs(
    x = NULL, # Elimina el título del eje x
    y = NULL, # Elimina el título del eje y
    fill = "Grado de acuerdo",
    title = "Figura 2.6: Participación en una toma en los últimos 12 meses"
  ) +
  theme_blank() +
  theme(
    axis.text.y = element_blank(),  # Ocultar etiquetas del eje y
    axis.ticks.y = element_blank(), # Ocultar marcas del eje y
    axis.title.x = element_blank(), # Ocultar título del eje x
    axis.title.y = element_blank(), # Ocultar título del eje y
    strip.text = element_text(size = 9, face = "bold"), # Ajustar tamaño y estilo del título de las facetas
    axis.text.x = element_text(size = 9), # Ajustar el tamaño de las etiquetas del eje x
    legend.position = "bottom",# Colocar la leyenda en la parte inferior
     plot.title = element_text(size = 12, face = "italic", color = "#8B7D7B")
  ) +
  scale_fill_brewer(palette = "Blues", 
                    labels = c("1" = "Sí", "2" = "No"),
                    name = NULL)
```

-   Marcha pacífica

```{r, echo=FALSE}
 #Calcular las frecuencias originales
frecuencias_originales <- proc_datos %>%
  pivot_longer(cols = c(genero_ES, educ_max, libros_hogar, curso_estudiante),
               names_to = "variable",
               values_to = "categoria") %>%
  group_by(variable, categoria) %>%
  summarise(Freq_Original = n(), .groups = 'drop')

# Combinar las frecuencias originales con la base transformada
proc_datos_largo <- proc_datos %>%
  pivot_longer(cols = c(genero_ES, educ_max, libros_hogar, curso_estudiante),
               names_to = "variable",
               values_to = "categoria")
frecuencias <- proc_datos_largo %>%
  group_by(variable, categoria, pp_presente_marcha) %>%
  summarise(Freq = n(), .groups = 'drop') %>%
  left_join(frecuencias_originales, by = c("variable", "categoria")) %>%
  mutate(Porcentaje = Freq / Freq_Original) %>%
  ungroup() %>% 
  na.omit()
# nombre facet_wrap
variable_names <- list("curso_estudiante" = "Curso",
                       "educ_max" = "Nivel educacional de los padres",
                       "genero_ES" = "Género",
                       "libros_hogar" = "Cantidad de libros en el hogar"
                       )
variable_labeller <- function(variable, value){return(variable_names[value])}

# Ajustar las etiquetas largas
frecuencias$categoria <- str_wrap(frecuencias$categoria, width = 10)

# Crear la gráfica
ggplot(frecuencias, aes(x = categoria, y = Porcentaje, fill = factor(pp_presente_marcha))) +
  geom_bar(stat = "identity", position = "fill", color = "white") +
  facet_wrap(~ variable, scales = "free_x", labeller = as_labeller(variable_labeller)) +
  geom_text(aes(label = scales::percent(Porcentaje, accuracy = 1)), 
            position = position_stack(vjust = 0.5), color = "black", size = 4.5) +
  labs(
    x = NULL, # Elimina el título del eje x
    y = NULL, # Elimina el título del eje y
    fill = "Grado de acuerdo",
    title = "Figura 2.7: Participación en una marcha pacífica en los últimos 12 meses"
  ) +
  theme_blank() +
  theme(
    axis.text.y = element_blank(),  # Ocultar etiquetas del eje y
    axis.ticks.y = element_blank(), # Ocultar marcas del eje y
    axis.title.x = element_blank(), # Ocultar título del eje x
    axis.title.y = element_blank(), # Ocultar título del eje y
    strip.text = element_text(size = 9, face = "bold"), # Ajustar tamaño y estilo del título de las facetas
    axis.text.x = element_text(size = 9), # Ajustar el tamaño de las etiquetas del eje x
    legend.position = "bottom",# Colocar la leyenda en la parte inferior
     plot.title = element_text(size = 12, face = "italic", color = "#8B7D7B")
  ) +
  scale_fill_brewer(palette = "Blues", 
                    labels = c("1" = "Sí", "2" = "No"),
                    name = NULL)
```

<br>

-   Participación civil en Internet

```{r, echo=FALSE}
# Combinar los gráficos
pp_civil_web_ES <- ggarrange(
   plot_p13_1_ES, 
   plot_presente_rrss_ES,
   
   
  common.legend = TRUE, 
  ncol = 2, 
  legend = "none"
)

pp_civil_rs_ES <- ggarrange(
   plot_p13_5_ES,
   plot_presente_compartir_ES,
   plot_presente_like_ES,
   
   
  common.legend = TRUE, 
  ncol = 3, 
  legend = "none"
)

pp_civil_internet <- ggarrange(
  pp_civil_web_ES,
  pp_civil_rs_ES,
  common.legend = TRUE, 
  nrow = 2, 
  legend = "bottom",
  legend.grob = get_legend(plot_p13_1_ES, "bottom"))
  

# Agregar una etiqueta global centrada
O <- annotate_figure(
 pp_civil_internet ,
  top = text_grob(
    "Figura 2.8: ¿Con qué frecuencia usas internet y redes sociales\npara las siguientes actividades? ",
    size = 12, 
    face = "italic", 
    color = "#8B7D7B",
    hjust = 0.5
  )
)

O
```

*Cruce con características sociodemográficas del estudiante*

-   Dar me gusta a contenido

```{r, echo=FALSE}
#Calcular las frecuencias originales
frecuencias_originales <- proc_datos %>%
  pivot_longer(cols = c(genero_ES, educ_max, libros_hogar, curso_estudiante),
               names_to = "variable",
               values_to = "categoria") %>%
  group_by(variable, categoria) %>%
  summarise(Freq_Original = n(), .groups = 'drop')

# Combinar las frecuencias originales con la base transformada
proc_datos_largo <- proc_datos %>%
  pivot_longer(cols = c(genero_ES, educ_max, libros_hogar, curso_estudiante),
               names_to = "variable",
               values_to = "categoria")
frecuencias <- proc_datos_largo %>%
  group_by(variable, categoria, pp_presente_like) %>%
  summarise(Freq = n(), .groups = 'drop') %>%
  left_join(frecuencias_originales, by = c("variable", "categoria")) %>%
  mutate(Porcentaje = Freq / Freq_Original) %>%
  ungroup() %>% 
  na.omit()
# nombre facet_wrap
variable_names <- list("curso_estudiante" = "Curso",
                       "educ_max" = "Nivel educacional de los padres",
                       "genero_ES" = "Género",
                       "libros_hogar" = "Cantidad de libros en el hogar"
                       )
variable_labeller <- function(variable, value){return(variable_names[value])}

# Ajustar las etiquetas largas
frecuencias$categoria <- str_wrap(frecuencias$categoria, width = 10)

# Crear la gráfica
ggplot(frecuencias, aes(x = categoria, y = Porcentaje, fill = factor(pp_presente_like))) +
  geom_bar(stat = "identity", position = "fill", color = "white") +
  facet_wrap(~ variable, scales = "free_x", labeller = as_labeller(variable_labeller)) +
  geom_text(aes(label = scales::percent(Porcentaje, accuracy = 1)), 
            position = position_stack(vjust = 0.5), color = "black", size = 4.5) +
  labs(
    x = NULL, # Elimina el título del eje x
    y = NULL, # Elimina el título del eje y
    fill = "Grado de acuerdo",
    title = "Figura 2.9: Uso de internet para dar me gusta acontenido sobre política"
  ) +
  theme_blank() +
  theme(
    axis.text.y = element_blank(),  # Ocultar etiquetas del eje y
    axis.ticks.y = element_blank(), # Ocultar marcas del eje y
    axis.title.x = element_blank(), # Ocultar título del eje x
    axis.title.y = element_blank(), # Ocultar título del eje y
    strip.text = element_text(size = 9, face = "bold"), # Ajustar tamaño y estilo del título de las facetas
    axis.text.x = element_text(size = 9), # Ajustar el tamaño de las etiquetas del eje x
    legend.position = "bottom",# Colocar la leyenda en la parte inferior
     plot.title = element_text(size = 12, face = "italic", color = "#8B7D7B")
  ) +
  scale_fill_brewer(palette = "Blues", 
                    labels = c("1" = "Nunca", "2" = "Una vez al año", "3" = "Una vez al mes", "4" = "Semanalmente", "5" = "Todos los días"),
                    name = NULL)
```

-   Ver un sitio Web

```{r, echo=FALSE}
#Calcular las frecuencias originales
frecuencias_originales <- proc_datos %>%
  pivot_longer(cols = c(genero_ES, educ_max, libros_hogar, curso_estudiante),
               names_to = "variable",
               values_to = "categoria") %>%
  group_by(variable, categoria) %>%
  summarise(Freq_Original = n(), .groups = 'drop')

# Combinar las frecuencias originales con la base transformada
proc_datos_largo <- proc_datos %>%
  pivot_longer(cols = c(genero_ES, educ_max, libros_hogar, curso_estudiante),
               names_to = "variable",
               values_to = "categoria")
frecuencias <- proc_datos_largo %>%
  group_by(variable, categoria, p13_1) %>%
  summarise(Freq = n(), .groups = 'drop') %>%
  left_join(frecuencias_originales, by = c("variable", "categoria")) %>%
  mutate(Porcentaje = Freq / Freq_Original) %>%
  ungroup() %>% 
  na.omit()
# nombre facet_wrap
variable_names <- list("curso_estudiante" = "Curso",
                       "educ_max" = "Nivel educacional de los padres",
                       "genero_ES" = "Género",
                       "libros_hogar" = "Cantidad de libros en el hogar"
                       )
variable_labeller <- function(variable, value){return(variable_names[value])}

# Ajustar las etiquetas largas
frecuencias$categoria <- str_wrap(frecuencias$categoria, width = 10)

# Crear la gráfica
ggplot(frecuencias, aes(x = categoria, y = Porcentaje, fill = factor(p13_1))) +
  geom_bar(stat = "identity", position = "fill", color = "white") +
  facet_wrap(~ variable, scales = "free_x", labeller = as_labeller(variable_labeller)) +
  geom_text(aes(label = scales::percent(Porcentaje, accuracy = 1)), 
            position = position_stack(vjust = 0.5), color = "black", size = 4.5) +
  labs(
    x = NULL, # Elimina el título del eje x
    y = NULL, # Elimina el título del eje y
    fill = "Grado de acuerdo",
    title = "Figura 2.10: Uso de internet para ver un sitio Web sobre política"
  ) +
  theme_blank() +
  theme(
    axis.text.y = element_blank(),  # Ocultar etiquetas del eje y
    axis.ticks.y = element_blank(), # Ocultar marcas del eje y
    axis.title.x = element_blank(), # Ocultar título del eje x
    axis.title.y = element_blank(), # Ocultar título del eje y
    strip.text = element_text(size = 9, face = "bold"), # Ajustar tamaño y estilo del título de las facetas
    axis.text.x = element_text(size = 9), # Ajustar el tamaño de las etiquetas del eje x
    legend.position = "bottom",# Colocar la leyenda en la parte inferior
     plot.title = element_text(size = 12, face = "italic", color = "#8B7D7B")
  ) +
  scale_fill_brewer(palette = "Blues", 
                    labels = c("1" = "Nunca", "2" = "Una vez al año", "3" = "Una vez al mes", "4" = "Semanalmente", "5" = "Todos los días"),
                    name = NULL)
```

-   Informarse en Redes Sociales

```{r, echo=FALSE}
#Calcular las frecuencias originales
frecuencias_originales <- proc_datos %>%
  pivot_longer(cols = c(genero_ES, educ_max, libros_hogar, curso_estudiante),
               names_to = "variable",
               values_to = "categoria") %>%
  group_by(variable, categoria) %>%
  summarise(Freq_Original = n(), .groups = 'drop')

# Combinar las frecuencias originales con la base transformada
proc_datos_largo <- proc_datos %>%
  pivot_longer(cols = c(genero_ES, educ_max, libros_hogar, curso_estudiante),
               names_to = "variable",
               values_to = "categoria")
frecuencias <- proc_datos_largo %>%
  group_by(variable, categoria, pp_presente_rrss) %>%
  summarise(Freq = n(), .groups = 'drop') %>%
  left_join(frecuencias_originales, by = c("variable", "categoria")) %>%
  mutate(Porcentaje = Freq / Freq_Original) %>%
  ungroup() %>% 
  na.omit()
# nombre facet_wrap
variable_names <- list("curso_estudiante" = "Curso",
                       "educ_max" = "Nivel educacional de los padres",
                       "genero_ES" = "Género",
                       "libros_hogar" = "Cantidad de libros en el hogar"
                       )
variable_labeller <- function(variable, value){return(variable_names[value])}

# Ajustar las etiquetas largas
frecuencias$categoria <- str_wrap(frecuencias$categoria, width = 10)

# Crear la gráfica
ggplot(frecuencias, aes(x = categoria, y = Porcentaje, fill = factor(pp_presente_rrss))) +
  geom_bar(stat = "identity", position = "fill", color = "white") +
  facet_wrap(~ variable, scales = "free_x", labeller = as_labeller(variable_labeller)) +
  geom_text(aes(label = scales::percent(Porcentaje, accuracy = 1)), 
            position = position_stack(vjust = 0.5), color = "black", size = 4.5) +
  labs(
    x = NULL, # Elimina el título del eje x
    y = NULL, # Elimina el título del eje y
    fill = "Grado de acuerdo",
    title = "Figura 2.11: Uso de internet para informarse en RR.SS sobre política"
  ) +
  theme_blank() +
  theme(
    axis.text.y = element_blank(),  # Ocultar etiquetas del eje y
    axis.ticks.y = element_blank(), # Ocultar marcas del eje y
    axis.title.x = element_blank(), # Ocultar título del eje x
    axis.title.y = element_blank(), # Ocultar título del eje y
    strip.text = element_text(size = 9, face = "bold"), # Ajustar tamaño y estilo del título de las facetas
    axis.text.x = element_text(size = 9), # Ajustar el tamaño de las etiquetas del eje x
    legend.position = "bottom",# Colocar la leyenda en la parte inferior
     plot.title = element_text(size = 12, face = "italic", color = "#8B7D7B")
  ) +
  scale_fill_brewer(palette = "Blues", 
                    labels = c("1" = "Nunca", "2" = "Una vez al año", "3" = "Una vez al mes", "4" = "Semanalmente", "5" = "Todos los días"),
                    name = NULL)
```

### Participación política futura

Esta sección refiere a preguntas respecto a las expectativas de participación política de los estudiantes cuando estos posean mayoría de edad. En particular, se presentarán preguntas relacionadas a su participación cívica en el futuro.

**Autoeficacia política**:

```{r, echo=FALSE}
#pp_futura_pol Cuando sea adulto(a) podré participar en la política ; acuerdo

pp_futura_pol = round(prop.table(table(categorias=proc_datos$pp_futura_pol)),2)
pp_futura_pol = as.data.frame(pp_futura_pol)
pp_futura_pol$categorias <- factor(pp_futura_pol$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo"))
plot_pp_futura_pol_ES<-ggplot(pp_futura_pol,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes")

```

```{r, echo=FALSE}
# dona genero: Mujer

basica_pp_futura_pol <- proc_datos %>% dplyr::filter(curso_estudiante=="Básica") %>% 
  dplyr::select(pp_futura_pol) #se filtran valores para esa categoría del curso
  
basica_pp_futura_pol = round(prop.table(table(categorias=basica_pp_futura_pol$pp_futura_pol)),2) #se crean variables 'categoria' y 'Freq' del objeto

basica_pp_futura_pol = as.data.frame(basica_pp_futura_pol) #convertimos el objeto en data.frame

#basica_esfuerzo <- factor(basica_esfuerzo$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo")) #por ahora lo saltaré

plot_basica_pp_futura_pol<-ggplot(basica_pp_futura_pol,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiante de básica") #graficamos


# dona curso: Media

# categoría media
media_pp_futura_pol <- proc_datos %>% filter(curso_estudiante=="Media") %>% 
  dplyr::select(pp_futura_pol) 

media_pp_futura_pol = round(prop.table(table(categorias=media_pp_futura_pol$pp_futura_pol)),2)  

media_pp_futura_pol = as.data.frame(media_pp_futura_pol)

plot_media_pp_futura_pol<-ggplot(media_pp_futura_pol,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiante de media") 
```

```{r, echo=FALSE}
# Combinar los gráficos
plot_pp_futura_pol_curso <- ggarrange(
   plot_basica_pp_futura_pol,
plot_media_pp_futura_pol, 
common.legend = TRUE,
  ncol = 2, 
legend = "none")


plot_pp_futura_pol_final <- ggarrange(
  plot_pp_futura_pol_ES,
  plot_pp_futura_pol_curso,                                 
  common.legend = TRUE, 
  nrow = 2, 
  legend = "bottom",
  legend.grob = get_legend(plot_pp_futura_pol_ES, "bottom"))

# Agregar una etiqueta global centrada
pp_futura <- annotate_figure(
 plot_pp_futura_pol_final ,
  top = text_grob(
    "Figura 2.12: Cuando sea adulto(a) podré participar en la política",
    size = 12, 
    face = "italic", 
    color = "#8B7D7B",
    hjust = 0.5
  )
)

pp_futura
```

*Cruces con características sociodemográficas del estudiante*

```{r, echo=FALSE, warning=FALSE, message=FALSE}
frecuencias <- proc_datos_largo %>%
  group_by(variable, categoria, pp_futura_pol) %>%
  summarise(Freq = n(), .groups = 'drop') %>%
  left_join(frecuencias_originales, by = c("variable", "categoria")) %>%
  mutate(Porcentaje = Freq / Freq_Original) %>%
  ungroup() %>% 
  na.omit()
# nombre facet_wrap
variable_names <- list("educ_max" = "Nivel educacional de los padres",
                       "genero_ES" = "Género",
                       "libros_hogar" = "Cantidad de libros en el hogar")
variable_labeller <- function(variable, value){return(variable_names[value])}

# Ajustar las etiquetas largas
frecuencias$categoria <- str_wrap(frecuencias$categoria, width = 10)

# Crear la gráfica
ggplot(frecuencias, aes(x = categoria, y = Porcentaje, fill = factor(pp_futura_pol))) +
  geom_bar(stat = "identity", position = "fill", color = "white") +
  facet_wrap(~ variable, scales = "free_x", labeller = as_labeller(variable_labeller)) +
  geom_text(aes(label = scales::percent(Porcentaje, accuracy = 1)), 
            position = position_stack(vjust = 0.5), color = "black", size = 4.5) +
  labs(
    x = NULL, # Elimina el título del eje x
    y = NULL, # Elimina el título del eje y
    fill = "Grado de acuerdo",
    title = "Figura 2.13: Cuando sea adulto(a) podré participar en la política"
  ) +
  theme_blank() +
  theme(
    axis.text.y = element_blank(),  # Ocultar etiquetas del eje y
    axis.ticks.y = element_blank(), # Ocultar marcas del eje y
    axis.title.x = element_blank(), # Ocultar título del eje x
    axis.title.y = element_blank(), # Ocultar título del eje y
    strip.text = element_text(size = 9, face = "bold"), # Ajustar tamaño y estilo del título de las facetas
    axis.text.x = element_text(size = 9), # Ajustar el tamaño de las etiquetas del eje x
    legend.position = "bottom",# Colocar la leyenda en la parte inferior
     plot.title = element_text(size = 12, face = "italic", color = "#8B7D7B")
  ) +
  scale_fill_brewer(palette = "Blues", 
                    labels = c("1" = "Muy en desacuerdo", "2" = "En desacuerdo", 
                               "3" = "De acuerdo", "4" = "Muy de acuerdo"),
                    name = NULL)
```

Participación **cívica** o **formal**:

```{r, echo=FALSE}

pp_futura_voto = round(prop.table(table(categorias=proc_datos$pp_futura_voto)),2)
pp_futura_voto = as.data.frame(pp_futura_voto)
pp_futura_voto$categorias <- factor(pp_futura_voto$categorias, levels = c(1, 2, 3, 4), labels = c("Seguro no haré esto", "Tal vez haré esto", "Probablemente haré esto", "Seguro haré esto"))
plot_pp_futura_voto_ES<-ggplot(pp_futura_voto,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Votar en elecciones presidenciales")


pp_futura_candidatos = round(prop.table(table(categorias=proc_datos$pp_futura_candidatos)),2)
pp_futura_candidatos = as.data.frame(pp_futura_candidatos)
pp_futura_candidatos$categorias <- factor(pp_futura_candidatos$categorias, levels = c(1, 2, 3, 4), labels = c("Seguro no haré esto", "Tal vez haré esto", "Probablemente haré esto", "Seguro haré esto"))
plot_pp_futura_candidatos_ES<-ggplot(pp_futura_candidatos,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Informarme de los candidatos")


p11_1 = round(prop.table(table(categorias=proc_datos$p11_1)),2)
p11_1 = as.data.frame(p11_1)
p11_1$categorias <- factor(p11_1$categorias, levels = c(1, 2, 3, 4), labels = c("Seguro no haré esto", "Tal vez haré esto", "Probablemente haré esto", "Seguro haré esto"))
plot_p11_1_ES<-ggplot(p11_1,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Votar en elecciones municipales")
```

```{r, echo=FALSE}
# Combinar los gráficos
pp_civica_fut_ES <- ggarrange(
   plot_pp_futura_voto_ES,
plot_p11_1_ES, 
common.legend = TRUE,
  ncol = 2,
legend = "none")

pp_civica_fut_ES_final <- ggarrange(pp_civica_fut_ES,plot_pp_futura_candidatos_ES,
                                  common.legend = TRUE, 
  nrow = 2, 
  legend = "bottom")

# Agregar una etiqueta global centrada
y <- annotate_figure(
 pp_civica_fut_ES_final ,
  top = text_grob(
    "Figura 2.14: Cuando seas adulto, ¿qué crees que vas a hacer?",
    size = 12, 
    face = "italic", 
    color = "#8B7D7B",
    hjust = 0.5
  )
)

y
```

*Cruce con características sociodemográficas del estudiante*

-   Votar en elecciones presidenciales

```{r, echo=FALSE}
frecuencias <- proc_datos_largo %>%
  group_by(variable, categoria, pp_futura_voto) %>%
  summarise(Freq = n(), .groups = 'drop') %>%
  left_join(frecuencias_originales, by = c("variable", "categoria")) %>%
  mutate(Porcentaje = Freq / Freq_Original) %>%
  ungroup() %>% 
  na.omit()
# nombre facet_wrap
variable_names <- list("curso_estudiante" = "Curso",
                       "educ_max" = "Nivel educacional de los padres",
                       "genero_ES" = "Género",
                       "libros_hogar" = "Cantidad de libros en el hogar")
variable_labeller <- function(variable, value){return(variable_names[value])}

# Ajustar las etiquetas largas
frecuencias$categoria <- str_wrap(frecuencias$categoria, width = 10)

# Crear la gráfica
ggplot(frecuencias, aes(x = categoria, y = Porcentaje, fill = factor(pp_futura_voto))) +
  geom_bar(stat = "identity", position = "fill", color = "white") +
  facet_wrap(~ variable, scales = "free_x", labeller = as_labeller(variable_labeller)) +
  geom_text(aes(label = scales::percent(Porcentaje, accuracy = 1)), 
            position = position_stack(vjust = 0.5), color = "black", size = 4.5) +
  labs(
    x = NULL, # Elimina el título del eje x
    y = NULL, # Elimina el título del eje y
    fill = "Grado de acuerdo",
    title = "Figura 2.15: Cuando sea adulto(a) votaré en elecciones presidenciales"
  ) +
  theme_blank() +
  theme(
    axis.text.y = element_blank(),  # Ocultar etiquetas del eje y
    axis.ticks.y = element_blank(), # Ocultar marcas del eje y
    axis.title.x = element_blank(), # Ocultar título del eje x
    axis.title.y = element_blank(), # Ocultar título del eje y
    strip.text = element_text(size = 9, face = "bold"), # Ajustar tamaño y estilo del título de las facetas
    axis.text.x = element_text(size = 9), # Ajustar el tamaño de las etiquetas del eje x
    legend.position = "bottom",# Colocar la leyenda en la parte inferior
     plot.title = element_text(size = 12, face = "italic", color = "#8B7D7B")
  ) +
  scale_fill_brewer(palette = "Blues", 
                    labels = c("1" = "Seguro no haré esto", "2" = "Tal vez haré esto", 
                               "3" = "Probablemente haré esto", "4" = "Seguro haré esto"),
                    name = NULL)
```

-   Votar en elecciones municipales

```{r, echo=FALSE}
frecuencias <- proc_datos_largo %>%
  group_by(variable, categoria, p11_1) %>%
  summarise(Freq = n(), .groups = 'drop') %>%
  left_join(frecuencias_originales, by = c("variable", "categoria")) %>%
  mutate(Porcentaje = Freq / Freq_Original) %>%
  ungroup() %>% 
  na.omit()
# nombre facet_wrap
variable_names <- list("curso_estudiante" = "Curso",
                       "educ_max" = "Nivel educacional de los padres",
                       "genero_ES" = "Género",
                       "libros_hogar" = "Cantidad de libros en el hogar")
variable_labeller <- function(variable, value){return(variable_names[value])}

# Ajustar las etiquetas largas
frecuencias$categoria <- str_wrap(frecuencias$categoria, width = 10)

# Crear la gráfica
ggplot(frecuencias, aes(x = categoria, y = Porcentaje, fill = factor(p11_1))) +
  geom_bar(stat = "identity", position = "fill", color = "white") +
  facet_wrap(~ variable, scales = "free_x", labeller = as_labeller(variable_labeller)) +
  geom_text(aes(label = scales::percent(Porcentaje, accuracy = 1)), 
            position = position_stack(vjust = 0.5), color = "black", size = 4.5) +
  labs(
    x = NULL, # Elimina el título del eje x
    y = NULL, # Elimina el título del eje y
    fill = "Grado de acuerdo",
    title = "Figura 2.16: Cuando sea adulto(a) votaré en elecciones municipales"
  ) +
  theme_blank() +
  theme(
    axis.text.y = element_blank(),  # Ocultar etiquetas del eje y
    axis.ticks.y = element_blank(), # Ocultar marcas del eje y
    axis.title.x = element_blank(), # Ocultar título del eje x
    axis.title.y = element_blank(), # Ocultar título del eje y
    strip.text = element_text(size = 9, face = "bold"), # Ajustar tamaño y estilo del título de las facetas
    axis.text.x = element_text(size = 9), # Ajustar el tamaño de las etiquetas del eje x
    legend.position = "bottom",# Colocar la leyenda en la parte inferior
     plot.title = element_text(size = 12, face = "italic", color = "#8B7D7B")
  ) +
  scale_fill_brewer(palette = "Blues", 
                    labels = c("1" = "Seguro no haré esto", "2" = "Tal vez haré esto", 
                               "3" = "Probablemente haré esto", "4" = "Seguro haré esto"),
                    name = NULL)
```

-   Informarme de los candidatos

```{r, echo=FALSE}
frecuencias <- proc_datos_largo %>%
  group_by(variable, categoria, pp_futura_candidatos) %>%
  summarise(Freq = n(), .groups = 'drop') %>%
  left_join(frecuencias_originales, by = c("variable", "categoria")) %>%
  mutate(Porcentaje = Freq / Freq_Original) %>%
  ungroup() %>% 
  na.omit()
# nombre facet_wrap
variable_names <- list("curso_estudiante" = "Curso",
                       "educ_max" = "Nivel educacional de los padres",
                       "genero_ES" = "Género",
                       "libros_hogar" = "Cantidad de libros en el hogar")
variable_labeller <- function(variable, value){return(variable_names[value])}

# Ajustar las etiquetas largas
frecuencias$categoria <- str_wrap(frecuencias$categoria, width = 10)

# Crear la gráfica
ggplot(frecuencias, aes(x = categoria, y = Porcentaje, fill = factor(pp_futura_candidatos))) +
  geom_bar(stat = "identity", position = "fill", color = "white") +
  facet_wrap(~ variable, scales = "free_x", labeller = as_labeller(variable_labeller)) +
  geom_text(aes(label = scales::percent(Porcentaje, accuracy = 1)), 
            position = position_stack(vjust = 0.5), color = "black", size = 4.5) +
  labs(
    x = NULL, # Elimina el título del eje x
    y = NULL, # Elimina el título del eje y
    fill = "Grado de acuerdo",
    title = "Figura 2.17: Cuando sea adulto(a) me informaré de los candidatos"
  ) +
  theme_blank() +
  theme(
    axis.text.y = element_blank(),  # Ocultar etiquetas del eje y
    axis.ticks.y = element_blank(), # Ocultar marcas del eje y
    axis.title.x = element_blank(), # Ocultar título del eje x
    axis.title.y = element_blank(), # Ocultar título del eje y
    strip.text = element_text(size = 9, face = "bold"), # Ajustar tamaño y estilo del título de las facetas
    axis.text.x = element_text(size = 9), # Ajustar el tamaño de las etiquetas del eje x
    legend.position = "bottom",# Colocar la leyenda en la parte inferior
     plot.title = element_text(size = 12, face = "italic", color = "#8B7D7B")
  ) +
  scale_fill_brewer(palette = "Blues", 
                    labels = c("1" = "Seguro no haré esto", "2" = "Tal vez haré esto", 
                               "3" = "Probablemente haré esto", "4" = "Seguro haré esto"),
                    name = NULL)
```

## Buena ciudadanía

Esta sección se compone de una serie de afirmaciones que aluden al comportamiento que preferentemente debería tener un buen ciudadano en la sociedad chilena. En ese sentido, se entiende como un apartado que busca evaluar la formación ciudadana de las y los estudiantes en función del rol que estos entienden que debería cumplir idealmente el ciudadano. Además, se distinguen dos tipos: *aspectos de participación civil* y *aspectos de participación cívica*.

Asepctos de **participación civil**

```{r, echo=FALSE}
ciudadania_op = round(prop.table(table(categorias=proc_datos$ciudadania_op)),2)
ciudadania_op = as.data.frame(ciudadania_op)
ciudadania_op$categorias <- factor(ciudadania_op$categorias, levels = c(1, 2, 3, 4), labels = c("Nada importante", "Algo importante", "Importante", "Muy importante"))
plot_ciudadania_op_ES<-ggplot(ciudadania_op,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=9, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Respetar el derecho\nde otros a tener su propia\nopinión")

p10_3 = round(prop.table(table(categorias=proc_datos$p10_3)),2)
p10_3 = as.data.frame(p10_3)
p10_3$categorias <- factor(p10_3$categorias, levels = c(1, 2, 3, 4), labels = c("Nada importante", "Algo importante", "Importante", "Muy importante"))
plot_p10_3_ES<-ggplot(p10_3,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=9, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Aprender de la historia\ndel país")


p10_4 = round(prop.table(table(categorias=proc_datos$p10_4)),2)
p10_4 = as.data.frame(p10_4)
p10_4$categorias <- factor(p10_4$categorias, levels = c(1, 2, 3, 4), labels = c("Nada importante", "Algo importante", "Importante", "Muy importante"))
plot_p10_4_ES<-ggplot(p10_4,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=9, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Participar en protestas pacíficas\nen contra de las leyes\nque considera injustas")



p10_7 = round(prop.table(table(categorias=proc_datos$p10_7)),2)
p10_7 = as.data.frame(p10_7)
p10_7$categorias <- factor(p10_7$categorias, levels = c(1, 2, 3, 4), labels = c("Nada importante", "Algo importante", "Importante", "Muy importante"))
plot_p10_7_ES<-ggplot(p10_7,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=9, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Apoyar a personas\nen peor situación\nque uno")



p10_8 = round(prop.table(table(categorias=proc_datos$p10_8)),2)
p10_8 = as.data.frame(p10_8)
p10_8$categorias <- factor(p10_8$categorias, levels = c(1, 2, 3, 4), labels = c("Nada importante", "Algo importante", "Importante", "Muy importante"))
plot_p10_8_ES<-ggplot(p10_8,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=9, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Siempre pagar los\nimpuestos")
```

```{r, echo=FALSE}
# Combinar los gráficos
pp_civil_buena_ciudadania1 <- ggarrange(
   plot_ciudadania_op_ES,
plot_p10_7_ES, 
common.legend = TRUE,
  ncol = 2, 
legend = "none")

pp_civil_buena_ciudadania2 <- ggarrange(
   plot_p10_3_ES,
   plot_p10_4_ES,
plot_p10_8_ES,
common.legend = TRUE,
  ncol = 3, 
legend = "none")


pp_civil_buena_ciudadania_final <- ggarrange(
  pp_civil_buena_ciudadania1,
  pp_civil_buena_ciudadania2,                                 
  common.legend = TRUE, 
  nrow = 2, 
  legend = "bottom",
  legend.grob = get_legend(plot_ciudadania_op_ES, "bottom"))

# Agregar una etiqueta global centrada
pp <- annotate_figure(
 pp_civil_buena_ciudadania_final ,
  top = text_grob(
    "Figura 2.18: ¿Cuán importante son los siguientes\ncomportamientos para ser un\nbuen ciudadano(a) adulto(a)?",
    size = 12, 
    face = "italic", 
    color = "#8B7D7B",
    hjust = 0.5
  )
)

pp
```

*Cruce con características sociodemográficas del estudiante*

-   Respetar el derecho a opinión

```{r, echo=FALSE}
frecuencias <- proc_datos_largo %>%
  group_by(variable, categoria, ciudadania_op) %>%
  summarise(Freq = n(), .groups = 'drop') %>%
  left_join(frecuencias_originales, by = c("variable", "categoria")) %>%
  mutate(Porcentaje = Freq / Freq_Original) %>%
  ungroup() %>% 
  na.omit()
# nombre facet_wrap
variable_names <- list("curso_estudiante" = "Curso",
                       "educ_max" = "Nivel educacional de los padres",
                       "genero_ES" = "Género",
                       "libros_hogar" = "Cantidad de libros en el hogar")
variable_labeller <- function(variable, value){return(variable_names[value])}

# Ajustar las etiquetas largas
frecuencias$categoria <- str_wrap(frecuencias$categoria, width = 10)

# Crear la gráfica
ggplot(frecuencias, aes(x = categoria, y = Porcentaje, fill = factor(ciudadania_op))) +
  geom_bar(stat = "identity", position = "fill", color = "white") +
  facet_wrap(~ variable, scales = "free_x", labeller = as_labeller(variable_labeller)) +
  geom_text(aes(label = scales::percent(Porcentaje, accuracy = 1)), 
            position = position_stack(vjust = 0.5), color = "black", size = 4.5) +
  labs(
    x = NULL, # Elimina el título del eje x
    y = NULL, # Elimina el título del eje y
    fill = "Grado de acuerdo",
    title = "Figura 2.19: Importancia de respetar el derecho de otros a tener su propia opinión "
  ) +
  theme_blank() +
  theme(
    axis.text.y = element_blank(),  # Ocultar etiquetas del eje y
    axis.ticks.y = element_blank(), # Ocultar marcas del eje y
    axis.title.x = element_blank(), # Ocultar título del eje x
    axis.title.y = element_blank(), # Ocultar título del eje y
    strip.text = element_text(size = 9, face = "bold"), # Ajustar tamaño y estilo del título de las facetas
    axis.text.x = element_text(size = 9), # Ajustar el tamaño de las etiquetas del eje x
    legend.position = "bottom",# Colocar la leyenda en la parte inferior
     plot.title = element_text(size = 12, face = "italic", color = "#8B7D7B")
  ) +
  scale_fill_brewer(palette = "Blues", 
                    labels = c("1" = "Nada importante", "2" = "Algo importante", 
                               "3" = "Importante", "4" = "Muy importante"),
                    name = NULL)
```

-   Apoyar al más necesitado

```{r, echo=FALSE}
frecuencias <- proc_datos_largo %>%
  group_by(variable, categoria, p10_7) %>%
  summarise(Freq = n(), .groups = 'drop') %>%
  left_join(frecuencias_originales, by = c("variable", "categoria")) %>%
  mutate(Porcentaje = Freq / Freq_Original) %>%
  ungroup() %>% 
  na.omit()
# nombre facet_wrap
variable_names <- list("curso_estudiante" = "Curso",
                       "educ_max" = "Nivel educacional de los padres",
                       "genero_ES" = "Género",
                       "libros_hogar" = "Cantidad de libros en el hogar")
variable_labeller <- function(variable, value){return(variable_names[value])}

# Ajustar las etiquetas largas
frecuencias$categoria <- str_wrap(frecuencias$categoria, width = 10)

# Crear la gráfica
ggplot(frecuencias, aes(x = categoria, y = Porcentaje, fill = factor(p10_7))) +
  geom_bar(stat = "identity", position = "fill", color = "white") +
  facet_wrap(~ variable, scales = "free_x", labeller = as_labeller(variable_labeller)) +
  geom_text(aes(label = scales::percent(Porcentaje, accuracy = 1)), 
            position = position_stack(vjust = 0.5), color = "black", size = 4.5) +
  labs(
    x = NULL, # Elimina el título del eje x
    y = NULL, # Elimina el título del eje y
    fill = "Grado de acuerdo",
    title = "Figura 2.20: Importancia de apoyar a personas en peor situación que uno"
  ) +
  theme_blank() +
  theme(
    axis.text.y = element_blank(),  # Ocultar etiquetas del eje y
    axis.ticks.y = element_blank(), # Ocultar marcas del eje y
    axis.title.x = element_blank(), # Ocultar título del eje x
    axis.title.y = element_blank(), # Ocultar título del eje y
    strip.text = element_text(size = 9, face = "bold"), # Ajustar tamaño y estilo del título de las facetas
    axis.text.x = element_text(size = 9), # Ajustar el tamaño de las etiquetas del eje x
    legend.position = "bottom",# Colocar la leyenda en la parte inferior
     plot.title = element_text(size = 12, face = "italic", color = "#8B7D7B")
  ) +
  scale_fill_brewer(palette = "Blues", 
                    labels = c("1" = "Nada importante", "2" = "Algo importante", 
                               "3" = "Importante", "4" = "Muy importante"),
                    name = NULL)
```

-   Aprender historia

```{r, echo=FALSE}
frecuencias <- proc_datos_largo %>%
  group_by(variable, categoria, p10_3) %>%
  summarise(Freq = n(), .groups = 'drop') %>%
  left_join(frecuencias_originales, by = c("variable", "categoria")) %>%
  mutate(Porcentaje = Freq / Freq_Original) %>%
  ungroup() %>% 
  na.omit()
# nombre facet_wrap
variable_names <- list("curso_estudiante" = "Curso",
                       "educ_max" = "Nivel educacional de los padres",
                       "genero_ES" = "Género",
                       "libros_hogar" = "Cantidad de libros en el hogar")
variable_labeller <- function(variable, value){return(variable_names[value])}

# Ajustar las etiquetas largas
frecuencias$categoria <- str_wrap(frecuencias$categoria, width = 10)

# Crear la gráfica
ggplot(frecuencias, aes(x = categoria, y = Porcentaje, fill = factor(p10_3))) +
  geom_bar(stat = "identity", position = "fill", color = "white") +
  facet_wrap(~ variable, scales = "free_x", labeller = as_labeller(variable_labeller)) +
  geom_text(aes(label = scales::percent(Porcentaje, accuracy = 1)), 
            position = position_stack(vjust = 0.5), color = "black", size = 4.5) +
  labs(
    x = NULL, # Elimina el título del eje x
    y = NULL, # Elimina el título del eje y
    fill = "Grado de acuerdo",
    title = "Figura 2.21: Importancia de aprender de la historia del país"
  ) +
  theme_blank() +
  theme(
    axis.text.y = element_blank(),  # Ocultar etiquetas del eje y
    axis.ticks.y = element_blank(), # Ocultar marcas del eje y
    axis.title.x = element_blank(), # Ocultar título del eje x
    axis.title.y = element_blank(), # Ocultar título del eje y
    strip.text = element_text(size = 9, face = "bold"), # Ajustar tamaño y estilo del título de las facetas
    axis.text.x = element_text(size = 9), # Ajustar el tamaño de las etiquetas del eje x
    legend.position = "bottom",# Colocar la leyenda en la parte inferior
     plot.title = element_text(size = 12, face = "italic", color = "#8B7D7B")
  ) +
  scale_fill_brewer(palette = "Blues", 
                    labels = c("1" = "Nada importante", "2" = "Algo importante", 
                               "3" = "Importante", "4" = "Muy importante"),
                    name = NULL)
```

-   Participar en protestas pacíficas

```{r, echo=FALSE}
frecuencias <- proc_datos_largo %>%
  group_by(variable, categoria, p10_4) %>%
  summarise(Freq = n(), .groups = 'drop') %>%
  left_join(frecuencias_originales, by = c("variable", "categoria")) %>%
  mutate(Porcentaje = Freq / Freq_Original) %>%
  ungroup() %>% 
  na.omit()
# nombre facet_wrap
variable_names <- list("curso_estudiante" = "Curso",
                       "educ_max" = "Nivel educacional de los padres",
                       "genero_ES" = "Género",
                       "libros_hogar" = "Cantidad de libros en el hogar")
variable_labeller <- function(variable, value){return(variable_names[value])}

# Ajustar las etiquetas largas
frecuencias$categoria <- str_wrap(frecuencias$categoria, width = 10)

# Crear la gráfica
ggplot(frecuencias, aes(x = categoria, y = Porcentaje, fill = factor(p10_4))) +
  geom_bar(stat = "identity", position = "fill", color = "white") +
  facet_wrap(~ variable, scales = "free_x", labeller = as_labeller(variable_labeller)) +
  geom_text(aes(label = scales::percent(Porcentaje, accuracy = 1)), 
            position = position_stack(vjust = 0.5), color = "black", size = 4.5) +
  labs(
    x = NULL, # Elimina el título del eje x
    y = NULL, # Elimina el título del eje y
    fill = "Grado de acuerdo",
    title = "Figura 2.22: Importancia de participar en protestas pacíficas en contra de\nlas leyes que considera injustas"
  ) +
  theme_blank() +
  theme(
    axis.text.y = element_blank(),  # Ocultar etiquetas del eje y
    axis.ticks.y = element_blank(), # Ocultar marcas del eje y
    axis.title.x = element_blank(), # Ocultar título del eje x
    axis.title.y = element_blank(), # Ocultar título del eje y
    strip.text = element_text(size = 9, face = "bold"), # Ajustar tamaño y estilo del título de las facetas
    axis.text.x = element_text(size = 9), # Ajustar el tamaño de las etiquetas del eje x
    legend.position = "bottom",# Colocar la leyenda en la parte inferior
     plot.title = element_text(size = 12, face = "italic", color = "#8B7D7B")
  ) +
  scale_fill_brewer(palette = "Blues", 
                    labels = c("1" = "Nada importante", "2" = "Algo importante", 
                               "3" = "Importante", "4" = "Muy importante"),
                    name = NULL)
```

-   Pagar impuestos

```{r, echo=FALSE}
frecuencias <- proc_datos_largo %>%
  group_by(variable, categoria, p10_8) %>%
  summarise(Freq = n(), .groups = 'drop') %>%
  left_join(frecuencias_originales, by = c("variable", "categoria")) %>%
  mutate(Porcentaje = Freq / Freq_Original) %>%
  ungroup() %>% 
  na.omit()
# nombre facet_wrap
variable_names <- list("curso_estudiante" = "Curso",
                       "educ_max" = "Nivel educacional de los padres",
                       "genero_ES" = "Género",
                       "libros_hogar" = "Cantidad de libros en el hogar")
variable_labeller <- function(variable, value){return(variable_names[value])}

# Ajustar las etiquetas largas
frecuencias$categoria <- str_wrap(frecuencias$categoria, width = 10)

# Crear la gráfica
ggplot(frecuencias, aes(x = categoria, y = Porcentaje, fill = factor(p10_8))) +
  geom_bar(stat = "identity", position = "fill", color = "white") +
  facet_wrap(~ variable, scales = "free_x", labeller = as_labeller(variable_labeller)) +
  geom_text(aes(label = scales::percent(Porcentaje, accuracy = 1)), 
            position = position_stack(vjust = 0.5), color = "black", size = 4.5) +
  labs(
    x = NULL, # Elimina el título del eje x
    y = NULL, # Elimina el título del eje y
    fill = "Grado de acuerdo",
    title = "Figura 2.23: Importancia de siempre pagar los impuestos"
  ) +
  theme_blank() +
  theme(
    axis.text.y = element_blank(),  # Ocultar etiquetas del eje y
    axis.ticks.y = element_blank(), # Ocultar marcas del eje y
    axis.title.x = element_blank(), # Ocultar título del eje x
    axis.title.y = element_blank(), # Ocultar título del eje y
    strip.text = element_text(size = 9, face = "bold"), # Ajustar tamaño y estilo del título de las facetas
    axis.text.x = element_text(size = 9), # Ajustar el tamaño de las etiquetas del eje x
    legend.position = "bottom",# Colocar la leyenda en la parte inferior
     plot.title = element_text(size = 12, face = "italic", color = "#8B7D7B")
  ) +
  scale_fill_brewer(palette = "Blues", 
                    labels = c("1" = "Nada importante", "2" = "Algo importante", 
                               "3" = "Importante", "4" = "Muy importante"),
                    name = NULL)
```

Asepctos de **participación cívica**:

```{r, echo=FALSE}

# graifco dona: voto

ciudadania_voto = round(prop.table(table(categorias=proc_datos$ciudadania_voto)),2)
ciudadania_voto = as.data.frame(ciudadania_voto)
ciudadania_voto$categorias <- factor(ciudadania_voto$categorias, levels = c(1, 2, 3, 4), labels = c("Nada importante", "Algo importante", "Importante", "Muy importante"))
plot_ciudadania_voto_ES<-ggplot(ciudadania_voto,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=10, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Votar en todas las\nelecciones nacionales")



ciudadania_pp = round(prop.table(table(categorias=proc_datos$ciudadania_pp)),2)
ciudadania_pp = as.data.frame(ciudadania_pp)
ciudadania_pp$categorias <- factor(ciudadania_pp$categorias, levels = c(1, 2, 3, 4), labels = c("Nada importante", "Algo importante", "Importante", "Muy importante"))
plot_ciudadania_pp_ES<-ggplot(ciudadania_pp,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=10, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Unirse a un partido\npolítico")



ciudadania_ley = round(prop.table(table(categorias=proc_datos$ciudadania_ley)),2)
ciudadania_ley = as.data.frame(ciudadania_ley)
ciudadania_ley$categorias <- factor(ciudadania_ley$categorias, levels = c(1, 2, 3, 4), labels = c("Nada importante", "Algo importante", "Importante", "Muy importante"))
plot_ciudadania_ley_ES<-ggplot(ciudadania_ley,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=10, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Obdecer siempre\nla ley")
```

```{r, echo=FALSE}
# Combinar los gráficos
pp_civica_buena_ciudadania1 <- ggarrange(
plot_ciudadania_voto_ES, 
plot_ciudadania_pp_ES,
common.legend = TRUE,
  ncol = 2, 
legend = "none")



pp_civica_buena_ciudadania_final <- ggarrange(
  pp_civica_buena_ciudadania1, 
  plot_ciudadania_ley_ES,                                 
  common.legend = TRUE, 
  nrow = 2, 
  legend = "bottom",
  legend.grob = get_legend(plot_ciudadania_voto_ES, "bottom"))

# Agregar una etiqueta global centrada
ppc <- annotate_figure(
 pp_civica_buena_ciudadania_final ,
  top = text_grob(
    "Figura 2.24: ¿Cuán importante son los siguientes\ncomportamientos para ser un\nbuen ciudadano(a) adulto(a)?",
    size = 12, 
    face = "italic", 
    color = "#8B7D7B",
    hjust = 0.5
  )
)

ppc
```

*Cruce con características sociodemográficas del estudiante*

-   Votar

```{r, echo=FALSE}
frecuencias <- proc_datos_largo %>%
  group_by(variable, categoria, ciudadania_voto_es) %>%
  summarise(Freq = n(), .groups = 'drop') %>%
  left_join(frecuencias_originales, by = c("variable", "categoria")) %>%
  mutate(Porcentaje = Freq / Freq_Original) %>%
  ungroup() %>% 
  na.omit()
# nombre facet_wrap
variable_names <- list("curso_estudiante" = "Curso",
                       "educ_max" = "Nivel educacional de los padres",
                       "genero_ES" = "Género",
                       "libros_hogar" = "Cantidad de libros en el hogar")
variable_labeller <- function(variable, value){return(variable_names[value])}

# Ajustar las etiquetas largas
frecuencias$categoria <- str_wrap(frecuencias$categoria, width = 10)

# Crear la gráfica
ggplot(frecuencias, aes(x = categoria, y = Porcentaje, fill = factor(ciudadania_voto_es))) +
  geom_bar(stat = "identity", position = "fill", color = "white") +
  facet_wrap(~ variable, scales = "free_x", labeller = as_labeller(variable_labeller)) +
  geom_text(aes(label = scales::percent(Porcentaje, accuracy = 1)), 
            position = position_stack(vjust = 0.5), color = "black", size = 4.5) +
  labs(
    x = NULL, # Elimina el título del eje x
    y = NULL, # Elimina el título del eje y
    fill = "Grado de acuerdo",
    title = "Figura 2.25: Importancia de votar en todas las elecciones nacionales"
  ) +
  theme_blank() +
  theme(
    axis.text.y = element_blank(),  # Ocultar etiquetas del eje y
    axis.ticks.y = element_blank(), # Ocultar marcas del eje y
    axis.title.x = element_blank(), # Ocultar título del eje x
    axis.title.y = element_blank(), # Ocultar título del eje y
    strip.text = element_text(size = 9, face = "bold"), # Ajustar tamaño y estilo del título de las facetas
    axis.text.x = element_text(size = 9), # Ajustar el tamaño de las etiquetas del eje x
    legend.position = "bottom",# Colocar la leyenda en la parte inferior
     plot.title = element_text(size = 12, face = "italic", color = "#8B7D7B")
  ) +
  scale_fill_brewer(palette = "Blues", 
                    labels = c("1" = "Nada importante", "2" = "Algo importante", 
                               "3" = "Importante", "4" = "Muy importante"),
                    name = NULL)
```

-   Unirse a un partido político

```{r, echo=FALSE}
frecuencias <- proc_datos_largo %>%
  group_by(variable, categoria, ciudadania_pp) %>%
  summarise(Freq = n(), .groups = 'drop') %>%
  left_join(frecuencias_originales, by = c("variable", "categoria")) %>%
  mutate(Porcentaje = Freq / Freq_Original) %>%
  ungroup() %>% 
  na.omit()
# nombre facet_wrap
variable_names <- list("curso_estudiante" = "Curso",
                       "educ_max" = "Nivel educacional de los padres",
                       "genero_ES" = "Género",
                       "libros_hogar" = "Cantidad de libros en el hogar")
variable_labeller <- function(variable, value){return(variable_names[value])}

# Ajustar las etiquetas largas
frecuencias$categoria <- str_wrap(frecuencias$categoria, width = 10)

# Crear la gráfica
ggplot(frecuencias, aes(x = categoria, y = Porcentaje, fill = factor(ciudadania_pp))) +
  geom_bar(stat = "identity", position = "fill", color = "white") +
  facet_wrap(~ variable, scales = "free_x", labeller = as_labeller(variable_labeller)) +
  geom_text(aes(label = scales::percent(Porcentaje, accuracy = 1)), 
            position = position_stack(vjust = 0.5), color = "black", size = 4.5) +
  labs(
    x = NULL, # Elimina el título del eje x
    y = NULL, # Elimina el título del eje y
    fill = "Grado de acuerdo",
    title = "Figura 2.26: Importancia de unirse a un partido político"
  ) +
  theme_blank() +
  theme(
    axis.text.y = element_blank(),  # Ocultar etiquetas del eje y
    axis.ticks.y = element_blank(), # Ocultar marcas del eje y
    axis.title.x = element_blank(), # Ocultar título del eje x
    axis.title.y = element_blank(), # Ocultar título del eje y
    strip.text = element_text(size = 9, face = "bold"), # Ajustar tamaño y estilo del título de las facetas
    axis.text.x = element_text(size = 9), # Ajustar el tamaño de las etiquetas del eje x
    legend.position = "bottom",# Colocar la leyenda en la parte inferior
     plot.title = element_text(size = 12, face = "italic", color = "#8B7D7B")
  ) +
  scale_fill_brewer(palette = "Blues", 
                    labels = c("1" = "Nada importante", "2" = "Algo importante", 
                               "3" = "Importante", "4" = "Muy importante"),
                    name = NULL)
```

-   Obdecer la ley

```{r, echo=FALSE}
frecuencias <- proc_datos_largo %>%
  group_by(variable, categoria, ciudadania_ley) %>%
  summarise(Freq = n(), .groups = 'drop') %>%
  left_join(frecuencias_originales, by = c("variable", "categoria")) %>%
  mutate(Porcentaje = Freq / Freq_Original) %>%
  ungroup() %>% 
  na.omit()
# nombre facet_wrap
variable_names <- list("curso_estudiante" = "Curso",
                       "educ_max" = "Nivel educacional de los padres",
                       "genero_ES" = "Género",
                       "libros_hogar" = "Cantidad de libros en el hogar")
variable_labeller <- function(variable, value){return(variable_names[value])}

# Ajustar las etiquetas largas
frecuencias$categoria <- str_wrap(frecuencias$categoria, width = 10)

# Crear la gráfica
ggplot(frecuencias, aes(x = categoria, y = Porcentaje, fill = factor(ciudadania_ley))) +
  geom_bar(stat = "identity", position = "fill", color = "white") +
  facet_wrap(~ variable, scales = "free_x", labeller = as_labeller(variable_labeller)) +
  geom_text(aes(label = scales::percent(Porcentaje, accuracy = 1)), 
            position = position_stack(vjust = 0.5), color = "black", size = 4.5) +
  labs(
    x = NULL, # Elimina el título del eje x
    y = NULL, # Elimina el título del eje y
    fill = "Grado de acuerdo",
    title = "Figura 2.27: Importancia de obdecer siempre la ley"
  ) +
  theme_blank() +
  theme(
    axis.text.y = element_blank(),  # Ocultar etiquetas del eje y
    axis.ticks.y = element_blank(), # Ocultar marcas del eje y
    axis.title.x = element_blank(), # Ocultar título del eje x
    axis.title.y = element_blank(), # Ocultar título del eje y
    strip.text = element_text(size = 9, face = "bold"), # Ajustar tamaño y estilo del título de las facetas
    axis.text.x = element_text(size = 9), # Ajustar el tamaño de las etiquetas del eje x
    legend.position = "bottom",# Colocar la leyenda en la parte inferior
     plot.title = element_text(size = 12, face = "italic", color = "#8B7D7B")
  ) +
  scale_fill_brewer(palette = "Blues", 
                    labels = c("1" = "Nada importante", "2" = "Algo importante", 
                               "3" = "Importante", "4" = "Muy importante"),
                    name = NULL)
```

## Extra: Relación con el adulto en el hogar

En esta sección se caracteriza las conversaciones que tiene el estudiante con el adulto con el cual pasa más tiempo en el hogar. En ese contexto, se presenta el tema de política dentro de dicha relación.

Dentro de la pregunta "*¿De qué temas conversan generalmente con este adulto?*, se disponen una serie de temas, de los cuales se presentará las respuestas de los estudiantes entorno a las conversaciones sobre política con dicho adulto.

-   Tema: *Categoría "Política"*

```{r, echo=FALSE}

# grafico dona: conversación sobre política 

P16_o3 = round(prop.table(table(categorias=proc_datos$P16_o3)),2)
P16_o3 = as.data.frame(P16_o3)
P16_o3$categorias <- factor(P16_o3$categorias, levels = c(0,1), labels = c("No", "Sí"))
plot_P16_o3_ES<-ggplot(P16_o3,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank())+
  xlim(0.5,2.5) 
  
final_plot_P16_o3_ES <- annotate_figure(plot_P16_o3_ES,
  top = text_grob( "Figura 2.28: Conversar sobre política con el adulto en el hogar",
    size = 12, 
    face = "italic", 
    color = "#8B7D7B",
    hjust = 0.5))

final_plot_P16_o3_ES
```
