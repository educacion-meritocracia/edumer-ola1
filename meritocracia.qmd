# Meritocracia

```{r, data,echo=FALSE, include=FALSE}
pacman::p_load(dplyr, sjPlot, stargazer, kableExtra, texreg, haven, sjlabelled, ggplot2, summarytools, ggtext, ggpubr, hrbrthemes)

load("input/data/proc/ola1.RData")


```

```{r, preparacion, echo=FALSE, eval=TRUE}
#Base General con el cuestionario para estudiantes
#Codificamos los valores 99-88 como missing para todas las variables
proc_datos <- proc_datos %>% set_na(., na = c(99, 88))

for (i in names(dplyr::select(proc_datos, tidyselect::starts_with("p1_"), starts_with("p2_"), starts_with("p8_"), starts_with("p9_"), starts_with("p17_")))) {
  proc_datos[[i]] <- sjlabelled::set_labels(
    x = proc_datos[[i]],
    labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo")
  )
}


for (i in names(dplyr::select(proc_datos, tidyselect::starts_with("p10_")))) {
  proc_datos[[i]] <- sjlabelled::set_labels(
    x = proc_datos[[i]],
    labels = c("Nada importante", "Algo importante", "Importante", "Muy importante")
  )
}


for (i in names(dplyr::select(proc_datos, tidyselect::starts_with("p11_")))) {
  proc_datos[[i]] <- sjlabelled::set_labels(
    x = proc_datos[[i]],
    labels = c("Seguro no haré esto", "Tal vez haré esto", "Probablemente haré esto", "Seguro haré esto")
  )
}

for (i in names(dplyr::select(proc_datos, tidyselect::starts_with("p12_")))) {
  proc_datos[[i]] <- sjlabelled::set_labels(
    x = proc_datos[[i]],
    labels = c("Si", "No")
  )
}

for (i in names(dplyr::select(proc_datos, tidyselect::starts_with("p13_")))) {
  proc_datos[[i]] <- sjlabelled::set_labels(
    x = proc_datos[[i]],
    labels = c("Nunca", "Una vez al año", "Una vez al mes", "Semanalmente", "Todos los días")
  )
}


for (i in names(dplyr::select(proc_datos, tidyselect::starts_with("p18_")))) {
  proc_datos[[i]] <- sjlabelled::set_labels(
    x = proc_datos[[i]],
    labels = c("Nunca", "Casi nunca", "Casi siempre", "Siempre")
  )
}

```

La meritocracia es una idea o un principio que hace alusión a la forma en que serán asignados los recursos dentro de la sociedad. Dicha asignación, se realiza de acuerdo a una compensación ligada al mérito individual. Este último es central para entender la meritocracia, el cual se encuentra compuesto por las nociones de talento y esfuerzo. De ese modo ambos funcionan como criterios de mérito individual. 

Así, es posible hablar de un ideal meritocrático, el cual se observa simbólicamente dentro de la sociedad en términos de una ideología (es decir, un conjunto de ideas). Una de las formas en que se socializa esta ideología es a través de la educación. Por ello, este estudio busca observar la forma en que se expresa la meritocracia en la escuela. 

Con esa definición en mente, el presente módulo se estructurará en dos apartados: **meritocracia en la sociedad** y **meritocracia en la escuela**. Dentro de cada uno se observará operacionalmente la meritocracia a través de las *creencias de las/los estudiantes*. Asimismo, al interior de dichas creencias es posible distinguir dos tipos: *preferencias* respecto de lo que debería ocurrir en la sociedad o en la escuela y *percepciones* de lo que efectivamente ocurre al interior de esos dos espacios.

## Meritocracia en la sociedad

Dentro del espacio más general a nivel de la sociedad, se presentan preguntas que aluden a creencias respecto a lo que sucede (percepciones) o debería suceder (preferencias) en el país.

### Creencias en la meritocracia

Esta sección se dividirá en dos grandes creencias: percepciones y preferencias. Al interior de cada una, se describirán preguntas del cuestionario que hacen alusión a criterios de mérito individual, mérito en la sociedad y factores no meritocráticos.

#### Percepciones

-   Respecto a criterios de mérito individual

```{r, dona-esfuerzo-ES, echo=FALSE}

# grafico dona: esfuerzo y estudiantes 

merit_esfuerzo_percep_ES = round(prop.table(table(categorias=proc_datos$merit_esfuerzo_percep_ES)),2)
merit_esfuerzo_percep_ES = as.data.frame(merit_esfuerzo_percep_ES)
merit_esfuerzo_percep_ES$categorias <- factor(merit_esfuerzo_percep_ES$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo"))
plot_meritesfuerzo_percep_ES<-ggplot(merit_esfuerzo_percep_ES,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes" )

```

```{r, dona-esfuerzo-talento-AP, echo=FALSE}

# grafico dona: esfuerzo y apoderados 

merit_esfuerzo_percep_AP = round(prop.table(table(categorias=proc_datos$merit_esfuerzo_percep_AP)),2) 
merit_esfuerzo_percep_AP = as.data.frame(merit_esfuerzo_percep_AP)
merit_esfuerzo_percep_AP$categorias <- factor(merit_esfuerzo_percep_AP$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo")) 
plot_meritesfuerzo_percep_AP<-ggplot(merit_esfuerzo_percep_AP,aes(x=2,y=-Freq, fill=categorias))+  
  geom_bar(stat = "identity",  
           color="white")+    
  geom_text(aes(label = scales::percent(Freq)),  
            position=position_stack(vjust=0.5),color="black",size=4.5)+   coord_polar(theta = "y")+ 
  scale_fill_brewer(palette = "Blues")+  
  theme_void()+  
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +  
  labs(title="Apoderados" ) 

# grafico dona: talento y apoderados

merit_talento_percep_AP = round(prop.table(table(categorias=proc_datos$merit_talento_percep_AP)),2)
merit_talento_percep_AP = as.data.frame(merit_talento_percep_AP) 
merit_talento_percep_AP$categorias <- factor(merit_talento_percep_AP$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo"))  
plot_merittalento_percep_AP<-ggplot(merit_talento_percep_AP,aes(x=2,y=-Freq, fill=categorias))+ 
  geom_bar(stat = "identity", 
           color="white")+  
  geom_text(aes(label = scales::percent(Freq)), 
            position=position_stack(vjust=0.5),color="black",size=4.5)+   coord_polar(theta = "y")+ 
  scale_fill_brewer(palette = "Blues")+
  theme_void()+  
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+ 
  xlim(0.5,2.5)+ 
  labs(title="Apoderados") 
```

**Esfuerzo** en la sociedad chilena:

```{r, dona-esfuerzo-curso, echo=FALSE}

# gráfico: esfuerzo y curso

# dona curso: Básica

basica_esfuerzo <- proc_datos %>% dplyr::filter(curso_estudiante=="Básica") %>% 
  dplyr::select(merit_esfuerzo_percep_ES) #se filtran valores para esa categoría del curso
  
basica_esfuerzo = round(prop.table(table(categorias=basica_esfuerzo$merit_esfuerzo_percep_ES)),2) #se crean variables 'categoria' y 'Freq' del objeto

basica_esfuerzo = as.data.frame(basica_esfuerzo) #convertimos el objeto en data.frame

#basica_esfuerzo <- factor(basica_esfuerzo$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo")) #por ahora lo saltaré

plot_basica_esfuerzo<-ggplot(basica_esfuerzo,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes de básica") #graficamos


# dona curso: Media

# categoría media
media_esfuerzo <- proc_datos %>% filter(curso_estudiante=="Media") %>% 
  dplyr::select(merit_esfuerzo_percep_ES) 

media_esfuerzo = round(prop.table(table(categorias=media_esfuerzo$merit_esfuerzo_percep_ES)),2)  

media_esfuerzo = as.data.frame(media_esfuerzo)

plot_media_esfuerzo<-ggplot(media_esfuerzo,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes de media") 

```

```{r, plot-esfuerzo-percep, echo=FALSE}

# grafico esfuerzo en la sociedad

# Combinar los gráficos
merit_social_esfuerzo_percep <- ggarrange(
  plot_meritesfuerzo_percep_ES, 
  plot_meritesfuerzo_percep_AP,
  common.legend = TRUE, 
  ncol = 2, 
  legend = "none")

esfuerzo_curso <- ggarrange(
   plot_basica_esfuerzo, 
   plot_media_esfuerzo,
  common.legend = TRUE, 
 ncol = 2, 
  legend = "none")

merit_social_esfuerzo_percep_final <- ggarrange(
  merit_social_esfuerzo_percep,
  esfuerzo_curso,
  common.legend = TRUE, 
  nrow = 2, 
  legend = "bottom",
  legend.grob = get_legend(plot_meritesfuerzo_percep_ES, "bottom"))

# Agregar una etiqueta global centrada
final_plot <- annotate_figure(
  merit_social_esfuerzo_percep_final,
  top = text_grob(
    "Figura 1.1: En Chile, las personas son recompensadas\npor sus esfuerzos",
    size = 12, 
    face = "italic", 
    color = "#8B7D7B",
    hjust = 0.5))


final_plot
```

En primer lugar, se observan claras diferencias entre apoderados y estudiantes. Los apoderados estan en desacuerdo con la frase. Así, los estudiantes parecen estar más de acuerdo con que las personas en el país son recompensadas por sus esfuerzos (52%). Además, si se diferencia a los estudiantes por curso, es posible observar que los estdiantes de educación básica (80%) están más de acuerdo que los estudiantes de educación media (55%).

*Cruces con otras características sociodemográficas de estudiantes*

```{r, plot-esfuerzo-sociodemo-percep, echo=FALSE, message=FALSE}
library(dplyr)
library(tidyr)
library(ggplot2)
library(stringr)

# Calcular las frecuencias originales
frecuencias_originales <- proc_datos %>%
  pivot_longer(cols = c(genero_ES, educ_max, libros_hogar),
               names_to = "variable",
               values_to = "categoria") %>%
  group_by(variable, categoria) %>%
  summarise(Freq_Original = n(), .groups = 'drop')

# Combinar las frecuencias originales con la base transformada
proc_datos_largo <- proc_datos %>%
  pivot_longer(cols = c(genero_ES, educ_max, libros_hogar),
               names_to = "variable",
               values_to = "categoria")

frecuencias <- proc_datos_largo %>%
  group_by(variable, categoria, merit_esfuerzo_percep_ES) %>%
  summarise(Freq = n(), .groups = 'drop') %>%
  left_join(frecuencias_originales, by = c("variable", "categoria")) %>%
  mutate(Porcentaje = Freq / Freq_Original) %>%
  ungroup() %>% 
  na.omit()
# nombre facet_wrap
variable_names <- list("educ_max" = "Nivel educacional de los padres",
                       "genero_ES" = "Género",
                       "libros_hogar" = "Cantidad de libros en el hogar")
variable_labeller <- function(variable, value){return(variable_names[value])}

# Ajustar las etiquetas largas
frecuencias$categoria <- str_wrap(frecuencias$categoria, width = 10)

# Crear la gráfica
ggplot(frecuencias, aes(x = categoria, y = Porcentaje, fill = factor(merit_esfuerzo_percep_ES))) +
  geom_bar(stat = "identity", position = "fill", color = "white") +
  facet_wrap(~ variable, scales = "free_x", labeller = as_labeller(variable_labeller)) +
  geom_text(aes(label = scales::percent(Porcentaje, accuracy = 1)), 
            position = position_stack(vjust = 0.5), color = "black", size = 4.5) +
  labs(
    x = NULL, # Elimina el título del eje x
    y = NULL, # Elimina el título del eje y
    fill = "Grado de acuerdo",
    title = "Figura 1.2: En Chile, las personas son recompensadas por sus esfuerzos"
  ) +
  theme_blank() +
  theme(
    axis.text.y = element_blank(),  # Ocultar etiquetas del eje y
    axis.ticks.y = element_blank(), # Ocultar marcas del eje y
    axis.title.x = element_blank(), # Ocultar título del eje x
    axis.title.y = element_blank(), # Ocultar título del eje y
    strip.text = element_text(size = 9, face = "bold"), # Ajustar tamaño y estilo del título de las facetas
    axis.text.x = element_text(size = 9), # Ajustar el tamaño de las etiquetas del eje x
    legend.position = "bottom",# Colocar la leyenda en la parte inferior
     plot.title = element_text(size = 12, face = "italic", color = "#8B7D7B")
  ) +
  scale_fill_brewer(palette = "Blues", 
                    labels = c("1" = "Muy en desacuerdo", "2" = "En desacuerdo", 
                               "3" = "De acuerdo", "4" = "Muy de acuerdo"),
                    name = NULL)

```

<br>

**Talento** (inteligencia y habilidad) en la sociedad chilena:

```{r, dona-talento-ES, echo=FALSE}
# grafico dona: talento y estudiantes 

merit_talento_percep_ES = round(prop.table(table(categorias=proc_datos$merit_talento_percep_ES)),2)
merit_talento_percep_ES = as.data.frame(merit_talento_percep_ES)
merit_talento_percep_ES$categorias <- factor(merit_talento_percep_ES$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo"))

plot_merittalento_percep_ES<-ggplot(merit_talento_percep_ES,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity",
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5)+
  labs(title="Estudiantes")
```

```{r, dona-talento-curso, echo=FALSE}

# gráfico: talento y curso

# dona curso: Básica

basica_talento <- proc_datos %>% dplyr::filter(curso_estudiante=="Básica") %>% 
  dplyr::select(merit_talento_percep_ES) #se filtran valores para esa categoría del curso
  
basica_talento = round(prop.table(table(categorias=basica_talento$merit_talento_percep_ES)),2) #se crean variables 'categoria' y 'Freq' del objeto

basica_talento = as.data.frame(basica_talento) #convertimos el objeto en data.frame

#basica_esfuerzo <- factor(basica_esfuerzo$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo")) #por ahora lo saltaré

plot_basica_talento<-ggplot(basica_talento,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes de básica") #graficamos


# dona curso: Media

# categoría media
media_talento <- proc_datos %>% filter(curso_estudiante=="Media") %>% 
  dplyr::select(merit_talento_percep_ES) 

media_talento = round(prop.table(table(categorias=media_talento$merit_talento_percep_ES)),2)  

media_talento = as.data.frame(media_talento)

plot_media_talento<-ggplot(media_talento,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes de media") 
```

```{r, plot-talento-percep, echo=FALSE}

# grafico talento en la sociedad

# Combinar los gráficos
merit_social_talento_percep <- ggarrange(
  plot_merittalento_percep_ES, 
  plot_merittalento_percep_AP,
  common.legend = TRUE, 
  ncol = 2, 
  legend = "none")

talento_curso <- ggarrange(
   plot_basica_talento, 
   plot_media_talento,
  common.legend = TRUE, 
 ncol = 2, 
  legend = "none")

merit_social_talento_percep_final <- ggarrange(
  merit_social_talento_percep,
  talento_curso,
  common.legend = TRUE, 
  nrow = 2, 
  legend = "bottom",
  legend.grob = get_legend(plot_merittalento_percep_ES, "bottom"))

# Agregar una etiqueta global centrada
final_plot1 <- annotate_figure(
  merit_social_talento_percep_final,
  top = text_grob(
    "Figura 1.3: En Chile, las personas son recompensadas\npor su inteligencia y habilidad",
    size = 12, 
    face = "italic", 
    color = "#8B7D7B",
    hjust = 0.5))


final_plot1

```

Estudiantes se muestran más de acuerdo con la afirmación (71%). En cambio, los apoderados si bien tienen un gran porcentaje de acuerdo con el talento, este es un 50%. Por otro lado, estudiantes de enseñanza báscia se muestran más de acuerdo con la idea de que el talento es recompensado en la sociedad con un 76%.

*Cruces con otras características sociodemográficas de estudiantes*

```{r, plot-talento-sociodemo-percep, echo=FALSE}
frecuencias <- proc_datos_largo %>%
  group_by(variable, categoria, merit_talento_percep_ES) %>%
  summarise(Freq = n(), .groups = 'drop') %>%
  left_join(frecuencias_originales, by = c("variable", "categoria")) %>%
  mutate(Porcentaje = Freq / Freq_Original) %>%
  ungroup() %>% 
  na.omit()
# nombre facet_wrap
variable_names <- list("educ_max" = "Nivel educacional de los padres",
                       "genero_ES" = "Género",
                       "libros_hogar" = "Cantidad de libros en el hogar")
variable_labeller <- function(variable, value){return(variable_names[value])}

# Ajustar las etiquetas largas
frecuencias$categoria <- str_wrap(frecuencias$categoria, width = 10)

# Crear la gráfica
ggplot(frecuencias, aes(x = categoria, y = Porcentaje, fill = factor(merit_talento_percep_ES))) +
  geom_bar(stat = "identity", position = "fill", color = "white") +
  facet_wrap(~ variable, scales = "free_x", labeller = as_labeller(variable_labeller)) +
  geom_text(aes(label = scales::percent(Porcentaje, accuracy = 1)), 
            position = position_stack(vjust = 0.5), color = "black", size = 4.5) +
  labs(
    x = NULL, # Elimina el título del eje x
    y = NULL, # Elimina el título del eje y
    fill = "Grado de acuerdo",
    title = "Figura 1.4: En Chile, las personas son recompensadas por su inteligencia y habilidad"
  ) +
  theme_blank() +
  theme(
    axis.text.y = element_blank(),  # Ocultar etiquetas del eje y
    axis.ticks.y = element_blank(), # Ocultar marcas del eje y
    axis.title.x = element_blank(), # Ocultar título del eje x
    axis.title.y = element_blank(), # Ocultar título del eje y
    strip.text = element_text(size = 9, face = "bold"), # Ajustar tamaño y estilo del título de las facetas
    axis.text.x = element_text(size = 9), # Ajustar el tamaño de las etiquetas del eje x
    legend.position = "bottom",# Colocar la leyenda en la parte inferior
     plot.title = element_text(size = 12, face = "italic", color = "#8B7D7B")
  ) +
  scale_fill_brewer(palette = "Blues", 
                    labels = c("1" = "Muy en desacuerdo", "2" = "En desacuerdo", 
                               "3" = "De acuerdo", "4" = "Muy de acuerdo"),
                    name = NULL)


```

Respecto al **mérito** en la sociedad chilena:

```{r, dona-merito-ES-AP-percep, echo=FALSE}

# grafico dona: merito y estudiantes 

social_merito_percep_ES = round(prop.table(table(categorias=proc_datos$social_merito_percep_ES)),2)  
social_merito_percep_ES = as.data.frame(social_merito_percep_ES) 
social_merito_percep_ES$categorias <- factor(social_merito_percep_ES$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo"))  
plot_socialmerit_percep_ES<-ggplot(social_merito_percep_ES,aes(x=2,y=-Freq, fill=categorias))+   
  geom_bar(stat = "identity",            
           color="white")+     
  geom_text(aes(label = scales::percent(Freq)),             
            position=position_stack(vjust=0.5),color="black",size=4.5)+  
  coord_polar(theta = "y")+   
  scale_fill_brewer(palette = "Blues")+   
  theme_void()+  
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5)+ 
  labs(title="Estudiantes") 

# grafico dona: merito y apoderados

social_merito_percep_AP = round(prop.table(table(categorias=proc_datos$social_merito_percep_AP)),2)  
social_merito_percep_AP = as.data.frame(social_merito_percep_AP) 
social_merito_percep_AP$categorias <- factor(social_merito_percep_AP$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo"))  
plot_socialmerit_percep_AP<-ggplot(social_merito_percep_AP,aes(x=2,y=-Freq, fill=categorias))+   
  geom_bar(stat = "identity",            
           color="white")+     
  geom_text(aes(label = scales::percent(Freq)),             
            position=position_stack(vjust=0.5),color="black",size=4.5)+  
  coord_polar(theta = "y")+   
  scale_fill_brewer(palette = "Blues")+   
  theme_void()+  
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5)+ 
  labs(title="Apoderados") 

```

```{r, dona-merito-curso, echo=FALSE}

# gráfico: merito y curso

# dona curso: Básica

basica_merito <- proc_datos %>% dplyr::filter(curso_estudiante=="Básica") %>% 
  dplyr::select(social_merito_percep_ES) #se filtran valores para esa categoría del curso
  
basica_merito = round(prop.table(table(categorias=basica_merito$social_merito_percep_ES)),2) #se crean variables 'categoria' y 'Freq' del objeto

basica_merito = as.data.frame(basica_merito) #convertimos el objeto en data.frame

#basica_esfuerzo <- factor(basica_esfuerzo$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo")) #por ahora lo saltaré

plot_basica_merito<-ggplot(basica_merito,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes de básica") #graficamos


# dona curso: Media

# categoría media
media_merito <- proc_datos %>% filter(curso_estudiante=="Media") %>% 
  dplyr::select(social_merito_percep_ES) 

media_merito = round(prop.table(table(categorias=media_merito$social_merito_percep_ES)),2)  

media_merito = as.data.frame(media_merito)

plot_media_merito<-ggplot(media_merito,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes de media") 
```

```{r, plot-merito-percep, echo=FALSE}

# grafico merito en la sociedad

# Combinar los gráficos
plot_socialmerit_percep <- ggarrange(
 plot_socialmerit_percep_ES, 
 plot_socialmerit_percep_AP,
  common.legend = TRUE, 
  ncol = 2, 
  legend = "none")

merito_curso <- ggarrange(
   plot_basica_merito, 
   plot_media_merito,
  common.legend = TRUE, 
 ncol = 2, 
  legend = "none")

merit_social_percep_final <- ggarrange(
  plot_socialmerit_percep,
  merito_curso,
  common.legend = TRUE, 
  nrow = 2, 
  legend = "bottom",
  legend.grob = get_legend(plot_socialmerit_percep_ES, "bottom"))

# Agregar una etiqueta global centrada
final_plot2 <- annotate_figure(
  merit_social_percep_final,
  top = text_grob(
    "Figura 1.5: En Chile, todas las personas obtienen\nlo que merecen",
    size = 12, 
    face = "italic", 
    color = "#8B7D7B",
    hjust = 0.5))


final_plot2
```

Si bien estudiantes y apoderados también se muestran en su mayoría en desacuerdo, los estudiantes presentan un 20% de acuerdo con la afirmación.

*Cruces con características sociodemográficas de estudiantes*

```{r, echo=FALSE}
frecuencias <- proc_datos_largo %>%
  group_by(variable, categoria, social_merito_percep_ES) %>%
  summarise(Freq = n(), .groups = 'drop') %>%
  left_join(frecuencias_originales, by = c("variable", "categoria")) %>%
  mutate(Porcentaje = Freq / Freq_Original) %>%
  ungroup() %>% 
  na.omit()
# nombre facet_wrap
variable_names <- list("educ_max" = "Nivel educacional de los padres",
                       "genero_ES" = "Género",
                       "libros_hogar" = "Cantidad de libros en el hogar")
variable_labeller <- function(variable, value){return(variable_names[value])}

# Ajustar las etiquetas largas
frecuencias$categoria <- str_wrap(frecuencias$categoria, width = 10)

# Crear la gráfica
ggplot(frecuencias, aes(x = categoria, y = Porcentaje, fill = factor(social_merito_percep_ES))) +
  geom_bar(stat = "identity", position = "fill", color = "white") +
  facet_wrap(~ variable, scales = "free_x", labeller = as_labeller(variable_labeller)) +
  geom_text(aes(label = scales::percent(Porcentaje, accuracy = 1)), 
            position = position_stack(vjust = 0.5), color = "black", size = 4.5) +
  labs(
    x = NULL, # Elimina el título del eje x
    y = NULL, # Elimina el título del eje y
    fill = "Grado de acuerdo",
    title = "Figura 1.6: En Chile, todas las personas obtienen lo que merecen"
  ) +
  theme_blank() +
  theme(
    axis.text.y = element_blank(),  # Ocultar etiquetas del eje y
    axis.ticks.y = element_blank(), # Ocultar marcas del eje y
    axis.title.x = element_blank(), # Ocultar título del eje x
    axis.title.y = element_blank(), # Ocultar título del eje y
    strip.text = element_text(size = 9, face = "bold"), # Ajustar tamaño y estilo del título de las facetas
    axis.text.x = element_text(size = 9), # Ajustar el tamaño de las etiquetas del eje x
    legend.position = "bottom",# Colocar la leyenda en la parte inferior
     plot.title = element_text(size = 12, face = "italic", color = "#8B7D7B")
  ) +
  scale_fill_brewer(palette = "Blues", 
                    labels = c("1" = "Muy en desacuerdo", "2" = "En desacuerdo", 
                               "3" = "De acuerdo", "4" = "Muy de acuerdo"),
                    name = NULL)

```

<br>

-   Respecto a factores no meritocráticos

Estos factores aluden a externalidades del mérito individual como la herencia, los contactos y la suerte. Por ello, se presentan preguntas referidas a la percepción respecto a los logros individuales de las personas que tienen padres ricos, buenos contactos y mejores oportunidades en la vida.

**Padres ricos** y logro indiviudal en la sociedad chilena:

```{r, dona-padres-ricos-ES-AP-percep, echo=FALSE}

# grafico dona: padres ricos y estudiantes 

padres_ricos_percep_ES = round(prop.table(table(categorias=proc_datos$padres_ricos_percep_ES)),2)
padres_ricos_percep_ES = as.data.frame(padres_ricos_percep_ES)
padres_ricos_percep_ES$categorias <- factor(padres_ricos_percep_ES$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo"))
plot_padres_ricos_percep_ES<-ggplot(padres_ricos_percep_ES,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity",
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes")

# grafico dona: padres ricos y apoderados 

padres_ricos_percep_AP = round(prop.table(table(categorias=proc_datos$padres_ricos_percep_AP)),2)
padres_ricos_percep_AP = as.data.frame(padres_ricos_percep_AP)
padres_ricos_percep_AP$categorias <- factor(padres_ricos_percep_AP$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo"))
plot_padres_ricos_percep_AP<-ggplot(padres_ricos_percep_AP,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity",
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Apoderados")
```

```{r, echo=FALSE}
# gráfico: padres ricos y curso

# dona curso: Básica

basica_padres_ricos <- proc_datos %>% dplyr::filter(curso_estudiante=="Básica") %>% 
  dplyr::select(padres_ricos_percep_ES) #se filtran valores para esa categoría del curso
  
basica_padres_ricos = round(prop.table(table(categorias=basica_padres_ricos$padres_ricos_percep_ES)),2) #se crean variables 'categoria' y 'Freq' del objeto

basica_padres_ricos = as.data.frame(basica_padres_ricos) #convertimos el objeto en data.frame

#basica_esfuerzo <- factor(basica_esfuerzo$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo")) #por ahora lo saltaré

plot_basica_padres_ricos<-ggplot(basica_padres_ricos,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes de básica") #graficamos


# dona curso: Media

# categoría media
media_padres_ricos <- proc_datos %>% filter(curso_estudiante=="Media") %>% 
  dplyr::select(padres_ricos_percep_ES) 

media_padres_ricos = round(prop.table(table(categorias=media_padres_ricos$padres_ricos_percep_ES)),2)  

media_padres_ricos = as.data.frame(media_padres_ricos)

plot_media_padres_ricos<-ggplot(media_padres_ricos,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes de media") 

```

```{r, plot-padres-ricos-percep, echo=FALSE}

# grafico padres ricos 

# Combinar los gráficos
padres_ricos_percep <- ggarrange(
  plot_padres_ricos_percep_ES, 
  plot_padres_ricos_percep_AP,
  common.legend = TRUE, 
  ncol = 2, 
  legend = "none")

padres_ricos_curso <- ggarrange(
   plot_basica_padres_ricos, 
   plot_media_padres_ricos,
  common.legend = TRUE, 
 ncol = 2, 
  legend = "none")

padres_ricos_percep_final <- ggarrange(
  padres_ricos_percep,
  padres_ricos_curso,
  common.legend = TRUE, 
  nrow = 2, 
  legend = "bottom",
  legend.grob = get_legend(plot_padres_ricos_percep_ES, "bottom"))

# Agregar una etiqueta global centrada
final_plot7 <- annotate_figure(
  padres_ricos_percep_final,
  top = text_grob(
    "Figura 1.7: En Chile, quienes tienen padres ricos\nles va mejor en la vida",
    size = 12, 
    face = "italic", 
    color = "#8B7D7B",
    hjust = 0.5))


final_plot7

```

*Cruces con características sociodemográficas de estudiantes*

```{r, echo=FALSE}
frecuencias <- proc_datos_largo %>%
  group_by(variable, categoria, padres_ricos_percep_ES) %>%
  summarise(Freq = n(), .groups = 'drop') %>%
  left_join(frecuencias_originales, by = c("variable", "categoria")) %>%
  mutate(Porcentaje = Freq / Freq_Original) %>%
  ungroup() %>% 
  na.omit()
# nombre facet_wrap
variable_names <- list("educ_max" = "Nivel educacional de los padres",
                       "genero_ES" = "Género",
                       "libros_hogar" = "Cantidad de libros en el hogar")
variable_labeller <- function(variable, value){return(variable_names[value])}

# Ajustar las etiquetas largas
frecuencias$categoria <- str_wrap(frecuencias$categoria, width = 10)

# Crear la gráfica
ggplot(frecuencias, aes(x = categoria, y = Porcentaje, fill = factor(padres_ricos_percep_ES))) +
  geom_bar(stat = "identity", position = "fill", color = "white") +
  facet_wrap(~ variable, scales = "free_x", labeller = as_labeller(variable_labeller)) +
  geom_text(aes(label = scales::percent(Porcentaje, accuracy = 1)), 
            position = position_stack(vjust = 0.5), color = "black", size = 4.5) +
  labs(
    x = NULL, # Elimina el título del eje x
    y = NULL, # Elimina el título del eje y
    fill = "Grado de acuerdo",
    title = "Figura 1.8: En Chile, quienes tienen padres ricos les va mejor en la vida"
  ) +
  theme_blank() +
  theme(
    axis.text.y = element_blank(),  # Ocultar etiquetas del eje y
    axis.ticks.y = element_blank(), # Ocultar marcas del eje y
    axis.title.x = element_blank(), # Ocultar título del eje x
    axis.title.y = element_blank(), # Ocultar título del eje y
    strip.text = element_text(size = 9, face = "bold"), # Ajustar tamaño y estilo del título de las facetas
    axis.text.x = element_text(size = 9), # Ajustar el tamaño de las etiquetas del eje x
    legend.position = "bottom",# Colocar la leyenda en la parte inferior
     plot.title = element_text(size = 12, face = "italic", color = "#8B7D7B")
  ) +
  scale_fill_brewer(palette = "Blues", 
                    labels = c("1" = "Muy en desacuerdo", "2" = "En desacuerdo", 
                               "3" = "De acuerdo", "4" = "Muy de acuerdo"),
                    name = NULL)
```

**Buenos contactos** y logro individual en la sociedad chilena:

```{r, dona-buenos-contactos-ES-AP-percep,echo=FALSE}

# grafico dona: buenos contactos y estudiantes 

buenos_contactos_percep_ES = round(prop.table(table(categorias=proc_datos$buenos_contactos_percep_ES)),2)
buenos_contactos_percep_ES = as.data.frame(buenos_contactos_percep_ES)
buenos_contactos_percep_ES$categorias <- factor(buenos_contactos_percep_ES$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo"))
plot_contactos_percep_ES<-ggplot(buenos_contactos_percep_ES,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity",
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes")

# grafico dona: buenos contactos y apoderados

buenos_contactos_percep_AP = round(prop.table(table(categorias=proc_datos$buenos_contactos_percep_AP)),2)
buenos_contactos_percep_AP = as.data.frame(buenos_contactos_percep_AP)
buenos_contactos_percep_AP$categorias <- factor(buenos_contactos_percep_AP$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo"))
plot_contactos_percep_AP<-ggplot(buenos_contactos_percep_AP,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity",
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Apoderados")
```

```{r, echo=FALSE}
# gráfico: buenos contactos y curso

# dona curso: Básica

basica_buenos_contactos <- proc_datos %>% dplyr::filter(curso_estudiante=="Básica") %>% 
  dplyr::select(buenos_contactos_percep_ES) #se filtran valores para esa categoría del curso
  
basica_buenos_contactos = round(prop.table(table(categorias=basica_buenos_contactos$buenos_contactos_percep_ES)),2) #se crean variables 'categoria' y 'Freq' del objeto

basica_buenos_contactos = as.data.frame(basica_buenos_contactos) #convertimos el objeto en data.frame

#basica_esfuerzo <- factor(basica_esfuerzo$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo")) #por ahora lo saltaré

plot_basica_buenos_contactos<-ggplot(basica_buenos_contactos,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes de básica") #graficamos


# dona curso: Media

# categoría media
media_buenos_contactos <- proc_datos %>% filter(curso_estudiante=="Media") %>% 
  dplyr::select(buenos_contactos_percep_ES) 

media_buenos_contactos = round(prop.table(table(categorias=media_buenos_contactos$buenos_contactos_percep_ES)),2)  

media_buenos_contactos = as.data.frame(media_buenos_contactos)

plot_media_buenos_contactos<-ggplot(media_buenos_contactos,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes de media") 
```

```{r, plot-buenos-contactos-percep, echo=FALSE}

# grafico buenos contactos 

# Combinar los gráficos
contactos_percep <- ggarrange(
  plot_contactos_percep_ES, 
  plot_contactos_percep_AP,
  common.legend = TRUE, 
  ncol = 2, 
  legend = "none")

contactos_curso <- ggarrange(
   plot_basica_buenos_contactos, 
   plot_media_buenos_contactos,
  common.legend = TRUE, 
 ncol = 2, 
  legend = "none")

contactos_percep_final <- ggarrange(
  contactos_percep,
  contactos_curso,
  common.legend = TRUE, 
  nrow = 2, 
  legend = "bottom",
  legend.grob = get_legend(plot_contactos_percep_ES, "bottom"))

# Agregar una etiqueta global centrada
final_plot8 <- annotate_figure(
  contactos_percep_final,
  top = text_grob(
    "Figura 1.9: En Chile, quienes tienen buenos contactos\nles va mejor en la vida",
    size = 12, 
    face = "italic", 
    color = "#8B7D7B",
    hjust = 0.5))


final_plot8
```

*Cruce con características sociodemográficas*

```{r, echo=FALSE}

frecuencias <- proc_datos_largo %>%
  group_by(variable, categoria, buenos_contactos_percep_ES) %>%
  summarise(Freq = n(), .groups = 'drop') %>%
  left_join(frecuencias_originales, by = c("variable", "categoria")) %>%
  mutate(Porcentaje = Freq / Freq_Original) %>%
  ungroup() %>% 
  na.omit()
# nombre facet_wrap
variable_names <- list("educ_max" = "Nivel educacional de los padres",
                       "genero_ES" = "Género",
                       "libros_hogar" = "Cantidad de libros en el hogar")
variable_labeller <- function(variable, value){return(variable_names[value])}

# Ajustar las etiquetas largas
frecuencias$categoria <- str_wrap(frecuencias$categoria, width = 10)

# Crear la gráfica
ggplot(frecuencias, aes(x = categoria, y = Porcentaje, fill = factor(buenos_contactos_percep_ES))) +
  geom_bar(stat = "identity", position = "fill", color = "white") +
  facet_wrap(~ variable, scales = "free_x", labeller = as_labeller(variable_labeller)) +
  geom_text(aes(label = scales::percent(Porcentaje, accuracy = 1)), 
            position = position_stack(vjust = 0.5), color = "black", size = 4.5) +
  labs(
    x = NULL, # Elimina el título del eje x
    y = NULL, # Elimina el título del eje y
    fill = "Grado de acuerdo",
    title = "Figura 1.10: En Chile, quienes tienen buenos contactos les va mejor en la vida"
  ) +
  theme_blank() +
  theme(
    axis.text.y = element_blank(),  # Ocultar etiquetas del eje y
    axis.ticks.y = element_blank(), # Ocultar marcas del eje y
    axis.title.x = element_blank(), # Ocultar título del eje x
    axis.title.y = element_blank(), # Ocultar título del eje y
    strip.text = element_text(size = 9, face = "bold"), # Ajustar tamaño y estilo del título de las facetas
    axis.text.x = element_text(size = 9), # Ajustar el tamaño de las etiquetas del eje x
    legend.position = "bottom",# Colocar la leyenda en la parte inferior
     plot.title = element_text(size = 12, face = "italic", color = "#8B7D7B")
  ) +
  scale_fill_brewer(palette = "Blues", 
                    labels = c("1" = "Muy en desacuerdo", "2" = "En desacuerdo", 
                               "3" = "De acuerdo", "4" = "Muy de acuerdo"),
                    name = NULL)

```

**Oportunidades** y logro individual en la sociedad chilena:

```{r, dona-oportunidades-ES-AP, echo=FALSE}

# grafico dona: oportunidades y estudiantes

oportunidades_percep_ES = round(prop.table(table(categorias=proc_datos$oportunidades_percep_ES)),2)
oportunidades_percep_ES = as.data.frame(oportunidades_percep_ES)
oportunidades_percep_ES$categorias <- factor(oportunidades_percep_ES$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo"))
plot_oportunidad_percep_ES<-ggplot(oportunidades_percep_ES,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity",
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes")

# grafico dona: oportunidades y apoderados 

oportunidades_percep_AP = round(prop.table(table(categorias=proc_datos$oportunidades_percep_AP)),2)
oportunidades_percep_AP = as.data.frame(oportunidades_percep_AP)
oportunidades_percep_AP$categorias <- factor(oportunidades_percep_AP$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo"))
plot_oportunidad_percep_AP<-ggplot(oportunidades_percep_AP,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity",
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Apoderados")
```

```{r, echo=FALSE}
# gráfico: oportunidades y curso

# dona curso: Básica

basica_oportunidades <- proc_datos %>% dplyr::filter(curso_estudiante=="Básica") %>% 
  dplyr::select(oportunidades_percep_ES) #se filtran valores para esa categoría del curso
  
basica_oportunidades = round(prop.table(table(categorias=basica_oportunidades$oportunidades_percep_ES)),2) #se crean variables 'categoria' y 'Freq' del objeto

basica_oportunidades = as.data.frame(basica_oportunidades) #convertimos el objeto en data.frame

#basica_esfuerzo <- factor(basica_esfuerzo$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo")) #por ahora lo saltaré

plot_basica_oportunidades<-ggplot(basica_oportunidades,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes de básica") #graficamos


# dona curso: Media

# categoría media
media_oportunidades <- proc_datos %>% filter(curso_estudiante=="Media") %>% 
  dplyr::select(oportunidades_percep_ES) 

media_oportunidades = round(prop.table(table(categorias=media_oportunidades$oportunidades_percep_ES)),2)  

media_oportunidades = as.data.frame(media_oportunidades)

plot_media_oportunidades<-ggplot(media_oportunidades,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes de media") 
```

```{r, plot-oportunidades, echo=FALSE}

# grafico oportunidades

# Combinar los gráficos
oportunidades_percep <- ggarrange(
  plot_oportunidad_percep_ES, 
 plot_oportunidad_percep_AP,
  common.legend = TRUE, 
  ncol = 2, 
  legend = "none")

oportunidades_curso <- ggarrange(
   plot_basica_oportunidades, 
   plot_media_oportunidades,
  common.legend = TRUE, 
 ncol = 2, 
  legend = "none")

oportunidades_percep_final <- ggarrange(
  oportunidades_percep,
  oportunidades_curso,
  common.legend = TRUE, 
  nrow = 2, 
  legend = "bottom",
  legend.grob = get_legend(plot_oportunidad_percep_ES, "bottom"))

# Agregar una etiqueta global centrada
final_plot9 <- annotate_figure(
  padres_ricos_percep_final,
  top = text_grob(
    "Figura 1.11: En Chile, todas las personas tienen las mismas oportunidades\npara salir adelante",
    size = 12, 
    face = "italic", 
    color = "#8B7D7B",
    hjust = 0.5))


final_plot9
```

Descripción.....

*Cruces con características sociodemográficas de estudiantes*

```{r, echo=FALSE}

frecuencias <- proc_datos_largo %>%
  group_by(variable, categoria, oportunidades_percep_ES) %>%
  summarise(Freq = n(), .groups = 'drop') %>%
  left_join(frecuencias_originales, by = c("variable", "categoria")) %>%
  mutate(Porcentaje = Freq / Freq_Original) %>%
  ungroup() %>% 
  na.omit()
# nombre facet_wrap
variable_names <- list("educ_max" = "Nivel educacional de los padres",
                       "genero_ES" = "Género",
                       "libros_hogar" = "Cantidad de libros en el hogar")
variable_labeller <- function(variable, value){return(variable_names[value])}

# Ajustar las etiquetas largas
frecuencias$categoria <- str_wrap(frecuencias$categoria, width = 10)

# Crear la gráfica
ggplot(frecuencias, aes(x = categoria, y = Porcentaje, fill = factor(oportunidades_percep_ES))) +
  geom_bar(stat = "identity", position = "fill", color = "white") +
  facet_wrap(~ variable, scales = "free_x", labeller = as_labeller(variable_labeller)) +
  geom_text(aes(label = scales::percent(Porcentaje, accuracy = 1)), 
            position = position_stack(vjust = 0.5), color = "black", size = 4.5) +
  labs(
    x = NULL, # Elimina el título del eje x
    y = NULL, # Elimina el título del eje y
    fill = "Grado de acuerdo",
    title = "Figura 1.12: En Chile, todas las personas tienen las mismas oportunidades\npara salir adelante"
  ) +
  theme_blank() +
  theme(
    axis.text.y = element_blank(),  # Ocultar etiquetas del eje y
    axis.ticks.y = element_blank(), # Ocultar marcas del eje y
    axis.title.x = element_blank(), # Ocultar título del eje x
    axis.title.y = element_blank(), # Ocultar título del eje y
    strip.text = element_text(size = 9, face = "bold"), # Ajustar tamaño y estilo del título de las facetas
    axis.text.x = element_text(size = 9), # Ajustar el tamaño de las etiquetas del eje x
    legend.position = "bottom",# Colocar la leyenda en la parte inferior
     plot.title = element_text(size = 12, face = "italic", color = "#8B7D7B")
  ) +
  scale_fill_brewer(palette = "Blues", 
                    labels = c("1" = "Muy en desacuerdo", "2" = "En desacuerdo", 
                               "3" = "De acuerdo", "4" = "Muy de acuerdo"),
                    name = NULL)
```

#### Preferencias

-   Respecto a criterios de mérito individual

```{r, dona-esfuerzo-talento-ES-pref, echo=FALSE}

# grafico dona: esfuerzo y estudiantes 

merit_esfuerzo_pref_ES = round(prop.table(table(categorias=proc_datos$merit_esfuerzo_pref_ES)),2)
merit_esfuerzo_pref_ES = as.data.frame(merit_esfuerzo_pref_ES)
merit_esfuerzo_pref_ES$categorias <- factor(merit_esfuerzo_pref_ES$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo"))
plot_meritesfuerzo_pref_ES<-ggplot(merit_esfuerzo_pref_ES,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes" )

# grafico dona: talento y estudiantes

merit_talento_pref_ES = round(prop.table(table(categorias=proc_datos$merit_talento_pref_ES)),2)
merit_talento_pref_ES = as.data.frame(merit_talento_pref_ES)
merit_talento_pref_ES$categorias <- factor(merit_talento_pref_ES$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo"))
plot_merittalento_pref_ES<-ggplot(merit_talento_pref_ES,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity",
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5)+
  labs(title="Estudiantes")

```

```{r, dona-esfuerzo-talento-AP-pref, echo=FALSE}

# grafico dona: esfuerzo y apoderados

merit_esfuerzo_pref_AP = round(prop.table(table(categorias=proc_datos$merit_esfuerzo_pref_AP)),2) 
merit_esfuerzo_pref_AP = as.data.frame(merit_esfuerzo_pref_AP)
merit_esfuerzo_pref_AP$categorias <- factor(merit_esfuerzo_pref_AP$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo")) 
plot_meritesfuerzo_pref_AP<-ggplot(merit_esfuerzo_pref_AP,aes(x=2,y=-Freq, fill=categorias))+  
  geom_bar(stat = "identity",  
           color="white")+    
  geom_text(aes(label = scales::percent(Freq)),  
            position=position_stack(vjust=0.5),color="black",size=4.5)+   coord_polar(theta = "y")+ 
  scale_fill_brewer(palette = "Blues")+  
  theme_void()+  
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +  
  labs(title="Apoderados" ) 

# grafico dona: talento y apoderados

merit_talento_pref_AP = round(prop.table(table(categorias=proc_datos$merit_talento_pref_AP)),2)
merit_talento_pref_AP = as.data.frame(merit_talento_pref_AP) 
merit_talento_pref_AP$categorias <- factor(merit_talento_pref_AP$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo"))  
plot_merittalento_pref_AP<-ggplot(merit_talento_pref_AP,aes(x=2,y=-Freq, fill=categorias))+ 
  geom_bar(stat = "identity", 
           color="white")+  
  geom_text(aes(label = scales::percent(Freq)), 
            position=position_stack(vjust=0.5),color="black",size=4.5)+   coord_polar(theta = "y")+ 
  scale_fill_brewer(palette = "Blues")+
  theme_void()+  
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+ 
  xlim(0.5,2.5)+ 
  labs(title="Apoderados") 
```

**Esfuerzo** en la sociedad chilena:

```{r, echo=FALSE}
# gráfico: esfuerzo y curso

# dona curso: Básica

basica_esfuerzo_pref <- proc_datos %>% dplyr::filter(curso_estudiante=="Básica") %>% 
  dplyr::select(merit_esfuerzo_pref_ES) #se filtran valores para esa categoría del curso
  
basica_esfuerzo_pref = round(prop.table(table(categorias=basica_esfuerzo_pref$merit_esfuerzo_pref_ES)),2) #se crean variables 'categoria' y 'Freq' del objeto

basica_esfuerzo_pref = as.data.frame(basica_esfuerzo_pref) #convertimos el objeto en data.frame

#basica_esfuerzo <- factor(basica_esfuerzo$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo")) #por ahora lo saltaré

plot_basica_esfuerzo_pref<-ggplot(basica_esfuerzo_pref,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes de básica") #graficamos


# dona curso: Media

# categoría media
media_esfuerzo_pref <- proc_datos %>% filter(curso_estudiante=="Media") %>% 
  dplyr::select(merit_esfuerzo_pref_ES) 

media_esfuerzo_pref = round(prop.table(table(categorias=media_esfuerzo_pref$merit_esfuerzo_pref_ES)),2)  

media_esfuerzo_pref = as.data.frame(media_esfuerzo_pref)

plot_media_esfuerzo_pref<-ggplot(media_esfuerzo_pref,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes de media") 
```

```{r, plot-esfuerzo-pref, echo=FALSE}

# grafico esfuerzo 

# Combinar los gráficos
esfuerzo_pref <- ggarrange(
  plot_meritesfuerzo_pref_ES, 
  plot_meritesfuerzo_pref_AP,
  common.legend = TRUE, 
  ncol = 2, 
  legend = "none")

esfuerzo_pref_curso <- ggarrange(
   plot_basica_esfuerzo_pref, 
   plot_media_esfuerzo_pref,
  common.legend = TRUE, 
 ncol = 2, 
  legend = "none")

esfuerzo_pref_final <- ggarrange(
  esfuerzo_pref,
  esfuerzo_pref_curso,
  common.legend = TRUE, 
  nrow = 2, 
  legend = "bottom",
  legend.grob = get_legend(plot_meritesfuerzo_pref_ES, "bottom"))

# Agregar una etiqueta global centrada
final_pref_e <- annotate_figure(
  esfuerzo_pref_final,
  top = text_grob(
    "Figura 1.13: En Chile, Quienes más se esfuerzan\ndeberían obtener mayores recompensas \nque quienes se esfuerzan menos",
    size = 12, 
    face = "italic", 
    color = "#8B7D7B",
    hjust = 0.5))

final_pref_e
```

*Cruces con características sociodemográficas de estudiantes*

```{r, echo=FALSE}

frecuencias <- proc_datos_largo %>%
  group_by(variable, categoria, merit_esfuerzo_pref_ES) %>%
  summarise(Freq = n(), .groups = 'drop') %>%
  left_join(frecuencias_originales, by = c("variable", "categoria")) %>%
  mutate(Porcentaje = Freq / Freq_Original) %>%
  ungroup() %>% 
  na.omit()
# nombre facet_wrap
variable_names <- list("educ_max" = "Nivel educacional de los padres",
                       "genero_ES" = "Género",
                       "libros_hogar" = "Cantidad de libros en el hogar")
variable_labeller <- function(variable, value){return(variable_names[value])}

# Ajustar las etiquetas largas
frecuencias$categoria <- str_wrap(frecuencias$categoria, width = 10)

# Crear la gráfica
ggplot(frecuencias, aes(x = categoria, y = Porcentaje, fill = factor(merit_esfuerzo_pref_ES))) +
  geom_bar(stat = "identity", position = "fill", color = "white") +
  facet_wrap(~ variable, scales = "free_x", labeller = as_labeller(variable_labeller)) +
  geom_text(aes(label = scales::percent(Porcentaje, accuracy = 1)), 
            position = position_stack(vjust = 0.5), color = "black", size = 4.5) +
  labs(
    x = NULL, # Elimina el título del eje x
    y = NULL, # Elimina el título del eje y
    fill = "Grado de acuerdo",
    title = "Figura 1.14: En Chile, Quienes más se esfuerzan deberían obtener mayores recompensas \nque quienes se esfuerzan menos"
  ) +
  theme_blank() +
  theme(
    axis.text.y = element_blank(),  # Ocultar etiquetas del eje y
    axis.ticks.y = element_blank(), # Ocultar marcas del eje y
    axis.title.x = element_blank(), # Ocultar título del eje x
    axis.title.y = element_blank(), # Ocultar título del eje y
    strip.text = element_text(size = 9, face = "bold"), # Ajustar tamaño y estilo del título de las facetas
    axis.text.x = element_text(size = 9), # Ajustar el tamaño de las etiquetas del eje x
    legend.position = "bottom",# Colocar la leyenda en la parte inferior
     plot.title = element_text(size = 12, face = "italic", color = "#8B7D7B")
  ) +
  scale_fill_brewer(palette = "Blues", 
                    labels = c("1" = "Muy en desacuerdo", "2" = "En desacuerdo", 
                               "3" = "De acuerdo", "4" = "Muy de acuerdo"),
                    name = NULL)

```

**Talento** en la sociedad chilena:

```{r,echo=FALSE}
# gráfico: talento y curso

# dona curso: Básica

basica_talento_pref <- proc_datos %>% dplyr::filter(curso_estudiante=="Básica") %>% 
  dplyr::select(merit_talento_pref_ES) #se filtran valores para esa categoría del curso
  
basica_talento_pref = round(prop.table(table(categorias=basica_talento_pref$merit_talento_pref_ES)),2) #se crean variables 'categoria' y 'Freq' del objeto

basica_talento_pref = as.data.frame(basica_talento_pref) #convertimos el objeto en data.frame

#basica_esfuerzo <- factor(basica_esfuerzo$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo")) #por ahora lo saltaré

plot_basica_talento_pref<-ggplot(basica_talento_pref,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes de básica") #graficamos


# dona curso: Media

# categoría media
media_talento_pref <- proc_datos %>% filter(curso_estudiante=="Media") %>% 
  dplyr::select(merit_talento_pref_ES) 

media_talento_pref = round(prop.table(table(categorias=media_talento_pref$merit_talento_pref_ES)),2)  

media_talento_pref = as.data.frame(media_talento_pref)

plot_media_talento_pref<-ggplot(media_talento_pref,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes de media") 
```

```{r, plot-talento-pref, echo=FALSE}

# grafico talento 

# Combinar los gráficos
talento_pref <- ggarrange(
  plot_merittalento_pref_ES, 
  plot_merittalento_pref_AP,
  common.legend = TRUE, 
  ncol = 2, 
  legend = "none")

talento_pref_curso <- ggarrange(
   plot_basica_talento_pref, 
   plot_media_talento_pref,
  common.legend = TRUE, 
 ncol = 2, 
  legend = "none")

talento_pref_final <- ggarrange(
  talento_pref,
  talento_pref_curso,
  common.legend = TRUE, 
  nrow = 2, 
  legend = "bottom",
  legend.grob = get_legend(plot_merittalento_pref_ES, "bottom"))

# Agregar una etiqueta global centrada
final_plot_pref_t <- annotate_figure(
  talento_pref_final,
  top = text_grob(
    "Figura 1.15: En Chile, Quienes poseen más talento\ndeberían obtener mayores recompensas\nque quienes poseen menos talento",
    size = 12, 
    face = "italic", 
    color = "#8B7D7B",
    hjust = 0.5))


final_plot_pref_t
```

*Cruces con características sociodemográficas de estudiantes*

```{r, echo=FALSE}

frecuencias <- proc_datos_largo %>%
  group_by(variable, categoria, merit_talento_pref_ES) %>%
  summarise(Freq = n(), .groups = 'drop') %>%
  left_join(frecuencias_originales, by = c("variable", "categoria")) %>%
  mutate(Porcentaje = Freq / Freq_Original) %>%
  ungroup() %>% 
  na.omit()
# nombre facet_wrap
variable_names <- list("educ_max" = "Nivel educacional de los padres",
                       "genero_ES" = "Género",
                       "libros_hogar" = "Cantidad de libros en el hogar")
variable_labeller <- function(variable, value){return(variable_names[value])}

# Ajustar las etiquetas largas
frecuencias$categoria <- str_wrap(frecuencias$categoria, width = 10)

# Crear la gráfica
ggplot(frecuencias, aes(x = categoria, y = Porcentaje, fill = factor(merit_talento_pref_ES))) +
  geom_bar(stat = "identity", position = "fill", color = "white") +
  facet_wrap(~ variable, scales = "free_x", labeller = as_labeller(variable_labeller)) +
  geom_text(aes(label = scales::percent(Porcentaje, accuracy = 1)), 
            position = position_stack(vjust = 0.5), color = "black", size = 4.5) +
  labs(
    x = NULL, # Elimina el título del eje x
    y = NULL, # Elimina el título del eje y
    fill = "Grado de acuerdo",
    title = "Figura 1.16: En Chile, Quienes poseen más talento deberían obtener mayores recompensas\nque quienes poseen menos talento"
  ) +
  theme_blank() +
  theme(
    axis.text.y = element_blank(),  # Ocultar etiquetas del eje y
    axis.ticks.y = element_blank(), # Ocultar marcas del eje y
    axis.title.x = element_blank(), # Ocultar título del eje x
    axis.title.y = element_blank(), # Ocultar título del eje y
    strip.text = element_text(size = 9, face = "bold"), # Ajustar tamaño y estilo del título de las facetas
    axis.text.x = element_text(size = 9), # Ajustar el tamaño de las etiquetas del eje x
    legend.position = "bottom",# Colocar la leyenda en la parte inferior
     plot.title = element_text(size = 12, face = "italic", color = "#8B7D7B")
  ) +
  scale_fill_brewer(palette = "Blues", 
                    labels = c("1" = "Muy en desacuerdo", "2" = "En desacuerdo", 
                               "3" = "De acuerdo", "4" = "Muy de acuerdo"),
                    name = NULL)

```

-   Preferencia respecto a la recompensa en base al talento por sobre el esfuerzo

```{r, dona-merito-ES-pref, echo=FALSE}

# grafico dona: merito y estudiantes

social_merit_pref_ES = round(prop.table(table(categorias=proc_datos$social_merit_pref_ES)),2)
social_merit_pref_ES = as.data.frame(social_merit_pref_ES)
social_merit_pref_ES$categorias <- factor(social_merit_pref_ES$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo"))
plot_merit_pref_ES<-ggplot(social_merit_pref_ES,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5), color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes")
```

```{r,dona-merito-AP-pref, echo=FALSE}

# grafico dona: merito y apoderados

social_merit_pref_AP = round(prop.table(table(categorias=proc_datos$social_merit_pref_AP)),2) 
social_merit_pref_AP = as.data.frame(social_merit_pref_AP)
social_merit_pref_AP$categorias <- factor(social_merit_pref_AP$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo")) 
plot_merit_pref_AP<-ggplot(social_merit_pref_AP,aes(x=2,y=-Freq, fill=categorias))+  
  geom_bar(stat = "identity",  
           color="white")+    
  geom_text(aes(label = scales::percent(Freq)),  
            position=position_stack(vjust=0.5),color="black",size=4.5)+   coord_polar(theta = "y")+ 
  scale_fill_brewer(palette = "Blues")+  
  theme_void()+  
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +  
  labs(title="Apoderados") 

```

```{r, echo=FALSE}
# gráfico: esfuerzo y curso

# dona curso: Básica

basica_social_merit_pref <- proc_datos %>% dplyr::filter(curso_estudiante=="Básica") %>% 
  dplyr::select(social_merit_pref_ES) #se filtran valores para esa categoría del curso
  
basica_social_merit_pref = round(prop.table(table(categorias=basica_social_merit_pref$social_merit_pref_ES)),2) #se crean variables 'categoria' y 'Freq' del objeto

basica_social_merit_pref = as.data.frame(basica_social_merit_pref) #convertimos el objeto en data.frame

#basica_esfuerzo <- factor(basica_esfuerzo$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo")) #por ahora lo saltaré

plot_basica_social_merit_pref<-ggplot(basica_social_merit_pref,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes de básica") #graficamos


# dona curso: Media

# categoría media
media_social_merit_pref <- proc_datos %>% filter(curso_estudiante=="Media") %>% 
  dplyr::select(social_merit_pref_ES) 

media_social_merit_pref = round(prop.table(table(categorias=media_social_merit_pref$social_merit_pref_ES)),2)  

media_social_merit_pref = as.data.frame(media_social_merit_pref)

plot_media_social_merit_pref<-ggplot(media_social_merit_pref,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes de media") 
```

```{r, plot-merito-social-pref, echo=FALSE}

# grafico merito social 
# Combinar los gráficos
social_merit_pref <- ggarrange(
  plot_merit_pref_ES, 
  plot_merit_pref_AP,
  common.legend = TRUE, 
  ncol = 2, 
  legend = "none")

social_merit_pref_curso <- ggarrange(
   plot_basica_social_merit_pref, 
   plot_media_social_merit_pref,
  common.legend = TRUE, 
 ncol = 2, 
  legend = "none")

social_merit_pref_final <- ggarrange(
  social_merit_pref,
  social_merit_pref_curso,
  common.legend = TRUE, 
  nrow = 2, 
  legend = "bottom",
  legend.grob = get_legend(plot_merit_pref_ES, "bottom"))

# Agregar una etiqueta global centrada
final_plot_pref_m <- annotate_figure(
  social_merit_pref_final,
  top = text_grob(
    "Figura 1.17:  Está bien que las personas más inteligentes y/o talentosas\nganen más dinero, aun cuando requieran\nesforzarse menos para ello",
    size = 12, 
    face = "italic", 
    color = "#8B7D7B",
    hjust = 0.5))


final_plot_pref_m
```

*Cruces con características sociodemográficas de estudiantes*

```{r, echo=FALSE}

frecuencias <- proc_datos_largo %>%
  group_by(variable, categoria, social_merit_pref_ES) %>%
  summarise(Freq = n(), .groups = 'drop') %>%
  left_join(frecuencias_originales, by = c("variable", "categoria")) %>%
  mutate(Porcentaje = Freq / Freq_Original) %>%
  ungroup() %>% 
  na.omit()
# nombre facet_wrap
variable_names <- list("educ_max" = "Nivel educacional de los padres",
                       "genero_ES" = "Género",
                       "libros_hogar" = "Cantidad de libros en el hogar")
variable_labeller <- function(variable, value){return(variable_names[value])}

# Ajustar las etiquetas largas
frecuencias$categoria <- str_wrap(frecuencias$categoria, width = 10)

# Crear la gráfica
ggplot(frecuencias, aes(x = categoria, y = Porcentaje, fill = factor(social_merit_pref_ES))) +
  geom_bar(stat = "identity", position = "fill", color = "white") +
  facet_wrap(~ variable, scales = "free_x", labeller = as_labeller(variable_labeller)) +
  geom_text(aes(label = scales::percent(Porcentaje, accuracy = 1)), 
            position = position_stack(vjust = 0.5), color = "black", size = 4.5) +
  labs(
    x = NULL, # Elimina el título del eje x
    y = NULL, # Elimina el título del eje y
    fill = "Grado de acuerdo",
    title = "Figura 1.18:  Está bien que las personas más inteligentes y/o talentosas\nganen más dinero, aun cuando requieran esforzarse menos para ello"
  ) +
  theme_blank() +
  theme(
    axis.text.y = element_blank(),  # Ocultar etiquetas del eje y
    axis.ticks.y = element_blank(), # Ocultar marcas del eje y
    axis.title.x = element_blank(), # Ocultar título del eje x
    axis.title.y = element_blank(), # Ocultar título del eje y
    strip.text = element_text(size = 9, face = "bold"), # Ajustar tamaño y estilo del título de las facetas
    axis.text.x = element_text(size = 9), # Ajustar el tamaño de las etiquetas del eje x
    legend.position = "bottom",# Colocar la leyenda en la parte inferior
     plot.title = element_text(size = 12, face = "italic", color = "#8B7D7B")
  ) +
  scale_fill_brewer(palette = "Blues", 
                    labels = c("1" = "Muy en desacuerdo", "2" = "En desacuerdo", 
                               "3" = "De acuerdo", "4" = "Muy de acuerdo"),
                    name = NULL)
```

-   Respecto a factores no meritocráticos

Estos factores aluden a externalidades del mérito individual como la herencia, los contactos y la suerte. Por ello, se presentan preguntas referidas a la preferencia respecto a los logros individuales de las personas que tienen padres ricos, buenos contactos.

**Padres ricos**

```{r, dona-padres-ricos-ES-pref, echo=FALSE}

# grafico dona: padres ricos y estudiantes

padres_ricos_pref_ES = round(prop.table(table(categorias=proc_datos$padres_ricos_pref_ES)),2)
padres_ricos_pref_ES = as.data.frame(padres_ricos_pref_ES)
padres_ricos_pref_ES$categorias <- factor(padres_ricos_pref_ES$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo"))
plot_padres_ricos_pref_ES<-ggplot(padres_ricos_pref_ES,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes" )
```

```{r, dona-padres-ricos-AP-pref, echo=FALSE}

# grafico dona: padres ricos y apoderados 

padres_ricos_pref_AP = round(prop.table(table(categorias=proc_datos$padres_ricos_pref_AP)),2)
padres_ricos_pref_AP = as.data.frame(padres_ricos_pref_AP)
padres_ricos_pref_AP$categorias <- factor(padres_ricos_pref_AP$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo"))
plot_padres_ricos_pref_AP<-ggplot(padres_ricos_pref_AP,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
          color="white")+
    geom_text(aes(label = scales::percent(Freq)),
            position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
 xlim(0.5,2.5) +
  labs(title="Apoderados" )
```

```{r, echo=FALSE}
# gráfico: padres ricos y curso 

# dona curso: Básica

basica_padres_ricos_pref <- proc_datos %>% dplyr::filter(curso_estudiante=="Básica") %>% 
  dplyr::select(padres_ricos_pref_ES) #se filtran valores para esa categoría del curso
  
basica_padres_ricos_pref = round(prop.table(table(categorias=basica_padres_ricos_pref$padres_ricos_pref_ES)),2) #se crean variables 'categoria' y 'Freq' del objeto

basica_padres_ricos_pref = as.data.frame(basica_padres_ricos_pref) #convertimos el objeto en data.frame

#basica_esfuerzo <- factor(basica_esfuerzo$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo")) #por ahora lo saltaré

plot_basica_padres_ricos_pref<-ggplot(basica_padres_ricos_pref,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes de básica") #graficamos


# dona curso: Media

# categoría media
media_padres_ricos_pref <- proc_datos %>% filter(curso_estudiante=="Media") %>% 
  dplyr::select(padres_ricos_pref_ES) 

media_padres_ricos_pref = round(prop.table(table(categorias=media_padres_ricos_pref$padres_ricos_pref_ES)),2)  

media_padres_ricos_pref = as.data.frame(media_padres_ricos_pref)

plot_media_padres_ricos_pref<-ggplot(media_padres_ricos_pref,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes de media") 
```

```{r, plot-padres-ricos-pref, echo=FALSE}

# graficos padres ricos 

# Combinar los gráficos
padres_ricos_pref <- ggarrange(
  plot_padres_ricos_pref_ES, 
  plot_padres_ricos_pref_AP,
  common.legend = TRUE, 
  ncol = 2, 
  legend = "none")

padres_ricos_pref_curso <- ggarrange(
   plot_basica_padres_ricos_pref, 
   plot_media_padres_ricos_pref,
  common.legend = TRUE, 
 ncol = 2, 
  legend = "none")

padres_ricos_pref_final <- ggarrange(
  padres_ricos_pref,
  padres_ricos_pref_curso,
  common.legend = TRUE, 
  nrow = 2, 
  legend = "bottom",
  legend.grob = get_legend(plot_padres_ricos_pref_ES, "bottom"))

# Agregar una etiqueta global centrada
final_padres_ricos_pref_final <- annotate_figure(
  padres_ricos_pref_final,
  top = text_grob(
    "Figura 1.19:  Está bien que quienes tienen padres ricos\nles vaya bien en la vida",
    size = 12, 
    face = "italic", 
    color = "#8B7D7B",
    hjust = 0.5))


final_padres_ricos_pref_final
```

*Cruces con características sociodemográficas de estudiantes*

```{r, echo=FALSE}
frecuencias <- proc_datos_largo %>%
  group_by(variable, categoria, padres_ricos_pref_ES) %>%
  summarise(Freq = n(), .groups = 'drop') %>%
  left_join(frecuencias_originales, by = c("variable", "categoria")) %>%
  mutate(Porcentaje = Freq / Freq_Original) %>%
  ungroup() %>% 
  na.omit()
# nombre facet_wrap
variable_names <- list("educ_max" = "Nivel educacional de los padres",
                       "genero_ES" = "Género",
                       "libros_hogar" = "Cantidad de libros en el hogar")
variable_labeller <- function(variable, value){return(variable_names[value])}

# Ajustar las etiquetas largas
frecuencias$categoria <- str_wrap(frecuencias$categoria, width = 10)

# Crear la gráfica
ggplot(frecuencias, aes(x = categoria, y = Porcentaje, fill = factor(padres_ricos_pref_ES))) +
  geom_bar(stat = "identity", position = "fill", color = "white") +
  facet_wrap(~ variable, scales = "free_x", labeller = as_labeller(variable_labeller)) +
  geom_text(aes(label = scales::percent(Porcentaje, accuracy = 1)), 
            position = position_stack(vjust = 0.5), color = "black", size = 4.5) +
  labs(
    x = NULL, # Elimina el título del eje x
    y = NULL, # Elimina el título del eje y
    fill = "Grado de acuerdo",
    title = "Figura 1.20:  Está bien que quienes tienen padres ricos les vaya bien en la vida"
  ) +
  theme_blank() +
  theme(
    axis.text.y = element_blank(),  # Ocultar etiquetas del eje y
    axis.ticks.y = element_blank(), # Ocultar marcas del eje y
    axis.title.x = element_blank(), # Ocultar título del eje x
    axis.title.y = element_blank(), # Ocultar título del eje y
    strip.text = element_text(size = 9, face = "bold"), # Ajustar tamaño y estilo del título de las facetas
    axis.text.x = element_text(size = 9), # Ajustar el tamaño de las etiquetas del eje x
    legend.position = "bottom",# Colocar la leyenda en la parte inferior
     plot.title = element_text(size = 12, face = "italic", color = "#8B7D7B")
  ) +
  scale_fill_brewer(palette = "Blues", 
                    labels = c("1" = "Muy en desacuerdo", "2" = "En desacuerdo", 
                               "3" = "De acuerdo", "4" = "Muy de acuerdo"),
                    name = NULL)

```

**Buenos contactos**

```{r, dona-buenos-contactos-ES-pref, echo=FALSE}

# grafico dona: buenos contactos y estudiantes 

buenos_contactos_pref_ES = round(prop.table(table(categorias=proc_datos$buenos_contactos_pref_ES)),2)
buenos_contactos_pref_ES = as.data.frame(buenos_contactos_pref_ES)
buenos_contactos_pref_ES$categorias <- factor(buenos_contactos_pref_ES$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo"))
plot_buenos_contactos_pref_ES<-ggplot(buenos_contactos_pref_ES,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes" )
```

```{r, dona-buenos-contactos-AP-pref, echo=FALSE}

# grafico dona: buenos contactos y apoderados 

buenos_contactos_pref_AP = round(prop.table(table(categorias=proc_datos$buenos_contactos_pref_AP)),2)
buenos_contactos_pref_AP = as.data.frame(buenos_contactos_pref_AP)
buenos_contactos_pref_AP$categorias <- factor(buenos_contactos_pref_AP$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo"))
plot_buenos_contactos_pref_AP<-ggplot(buenos_contactos_pref_AP,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
             position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Apoderados" )
```

```{r, echo=FALSE}
# gráfico: buenos contactos y curso 

# dona curso: Básica

basica_buenos_contactos_pref <- proc_datos %>% dplyr::filter(curso_estudiante=="Básica") %>% 
  dplyr::select(buenos_contactos_pref_ES) #se filtran valores para esa categoría del curso
  
basica_buenos_contactos_pref = round(prop.table(table(categorias=basica_buenos_contactos_pref$buenos_contactos_pref_ES)),2) #se crean variables 'categoria' y 'Freq' del objeto

basica_buenos_contactos_pref = as.data.frame(basica_buenos_contactos_pref) #convertimos el objeto en data.frame

#basica_esfuerzo <- factor(basica_esfuerzo$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo")) #por ahora lo saltaré

plot_basica_buenos_contactos_pref<-ggplot(basica_buenos_contactos_pref,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes de básica") #graficamos


# dona curso: Media

# categoría media
media_buenos_contactos_pref <- proc_datos %>% filter(curso_estudiante=="Media") %>% 
  dplyr::select(buenos_contactos_pref_ES) 

media_buenos_contactos_pref = round(prop.table(table(categorias=media_buenos_contactos_pref$buenos_contactos_pref_ES)),2)  

media_buenos_contactos_pref = as.data.frame(media_buenos_contactos_pref)

plot_media_buenos_contactos_pref<-ggplot(media_buenos_contactos_pref,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes de media")
```

```{r, plot-buenos-contactos-pref, echo=FALSE}

# grafico buenos contactos 


# Combinar los gráficos
buenos_contactos_pref <- ggarrange(
  plot_buenos_contactos_pref_ES, 
  plot_buenos_contactos_pref_AP,
  common.legend = TRUE, 
  ncol = 2, 
  legend = "none")

buenos_contactos_pref_curso <- ggarrange(
   plot_basica_buenos_contactos_pref, 
   plot_media_buenos_contactos_pref,
  common.legend = TRUE, 
 ncol = 2, 
  legend = "none")

buenos_contactos_pref_final <- ggarrange(
  buenos_contactos_pref,
  buenos_contactos_pref_curso,
  common.legend = TRUE, 
  nrow = 2, 
  legend = "bottom",
  legend.grob = get_legend(plot_buenos_contactos_pref_ES, "bottom"))

# Agregar una etiqueta global centrada
final_buenos_contactos_pref <- annotate_figure(
  buenos_contactos_pref_final,
  top = text_grob(
    "Figura 1.21: Está bien que quienes tienen buenos contactos\nles vaya bien en la vida",
    size = 12, 
    face = "italic", 
    color = "#8B7D7B",
    hjust = 0.5))


final_buenos_contactos_pref
```

*Cruces con características sociodemográficas de estudiantes*

```{r, echo=FALSE}

frecuencias <- proc_datos_largo %>%
  group_by(variable, categoria, buenos_contactos_pref_ES) %>%
  summarise(Freq = n(), .groups = 'drop') %>%
  left_join(frecuencias_originales, by = c("variable", "categoria")) %>%
  mutate(Porcentaje = Freq / Freq_Original) %>%
  ungroup() %>% 
  na.omit()
# nombre facet_wrap
variable_names <- list("educ_max" = "Nivel educacional de los padres",
                       "genero_ES" = "Género",
                       "libros_hogar" = "Cantidad de libros en el hogar")
variable_labeller <- function(variable, value){return(variable_names[value])}

# Ajustar las etiquetas largas
frecuencias$categoria <- str_wrap(frecuencias$categoria, width = 10)

# Crear la gráfica
ggplot(frecuencias, aes(x = categoria, y = Porcentaje, fill = factor(buenos_contactos_pref_ES))) +
  geom_bar(stat = "identity", position = "fill", color = "white") +
  facet_wrap(~ variable, scales = "free_x", labeller = as_labeller(variable_labeller)) +
  geom_text(aes(label = scales::percent(Porcentaje, accuracy = 1)), 
            position = position_stack(vjust = 0.5), color = "black", size = 4.5) +
  labs(
    x = NULL, # Elimina el título del eje x
    y = NULL, # Elimina el título del eje y
    fill = "Grado de acuerdo",
    title = "Figura 1.22: Está bien que quienes tienen buenos contactos les vaya bien en la vida"
  ) +
  theme_blank() +
  theme(
    axis.text.y = element_blank(),  # Ocultar etiquetas del eje y
    axis.ticks.y = element_blank(), # Ocultar marcas del eje y
    axis.title.x = element_blank(), # Ocultar título del eje x
    axis.title.y = element_blank(), # Ocultar título del eje y
    strip.text = element_text(size = 9, face = "bold"), # Ajustar tamaño y estilo del título de las facetas
    axis.text.x = element_text(size = 9), # Ajustar el tamaño de las etiquetas del eje x
    legend.position = "bottom",# Colocar la leyenda en la parte inferior
     plot.title = element_text(size = 12, face = "italic", color = "#8B7D7B")
  ) +
  scale_fill_brewer(palette = "Blues", 
                    labels = c("1" = "Muy en desacuerdo", "2" = "En desacuerdo", 
                               "3" = "De acuerdo", "4" = "Muy de acuerdo"),
                    name = NULL)
```

## Meritocracia en la escuela

En este módulo se considera otro apartado adicional a las creencias de las/los estudiantes, el que está referido a la experiencia de estas mismas/mismos en sus notas. La forma en que se estudia la meritocracia escolar a partir de la experiencia en la nota se evidencia en la idea de que el mérito de ellas/ellos sea justamente reconocido en la nota obtenida. Por esa razón, dicho apartado se denominará "justicia en las notas".

De este modo, se presentan dos apartados: **creencias en la meritocracia** y **justicia en las notas**.

### Creencias en la meritocracia

#### Percepciones

-   Respecto a criterios de mérito individual

```{r, dona-school-merito-ES-percep, echo=FALSE}

# grafico dona: esfuerzo en la escuela y estudiante 

school_esfuerzo_ES = round(prop.table(table(categorias=proc_datos$school_esfuerzo_ES)),2)
school_esfuerzo_ES = as.data.frame(school_esfuerzo_ES)
school_esfuerzo_ES$categorias <- factor(school_esfuerzo_ES$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo"))
plot_school_esfuerzo_ES<-ggplot(school_esfuerzo_ES,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes" )

# grafico dona: talento en la escuela y estudiante 

school_talento_ES = round(prop.table(table(categorias=proc_datos$school_talento_ES)),2)
school_talento_ES = as.data.frame(school_talento_ES)
school_talento_ES$categorias <- factor(school_talento_ES$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo"))

plot_school_talento_ES<-ggplot(school_talento_ES,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity",
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5)+
  labs(title="Estudiantes")

# grafico dona: merito en la escuela y estudiante 

school_merito_ES = round(prop.table(table(categorias=proc_datos$school_merito_ES)),2)
school_merito_ES = as.data.frame(school_merito_ES)
school_merito_ES$categorias <- factor(school_merito_ES$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo"))

plot_school_merito_ES<-ggplot(school_merito_ES,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity",
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5)+
  labs(title="Estudiantes")

```

```{r, dona-school-merito-AP-percep,echo=FALSE}

# grafico dona: esfuerzo en la escuela apoderado

school_esfuerzo_AP = round(prop.table(table(categorias=proc_datos$school_esfuerzo_AP)),2)
school_esfuerzo_AP = as.data.frame(school_esfuerzo_AP)
school_esfuerzo_AP$categorias <- factor(school_esfuerzo_AP$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo"))
plot_school_esfuerzo_AP<-ggplot(school_esfuerzo_AP,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Apoderados" )

# grafico dona: talento en la escuela apoderado 

school_talento_AP = round(prop.table(table(categorias=proc_datos$school_talento_AP)),2)
school_talento_AP = as.data.frame(school_talento_AP)
school_talento_AP$categorias <- factor(school_talento_AP$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo"))
plot_school_talento_AP<-ggplot(school_talento_AP,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Apoderados" )

# grafico dona: merito en la escuela y apoderado 

school_merito_AP = round(prop.table(table(categorias=proc_datos$school_merito_AP)),2)
school_merito_AP = as.data.frame(school_merito_AP)
school_merito_AP$categorias <- factor(school_merito_AP$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo"))
plot_school_merito_AP<-ggplot(school_merito_AP,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Apoderados" )
```

**Esfuerzo** en la escuela:

```{r, echo=FALSE}
# gráfico: esfuerzo y curso 

# dona curso: Básica

basica_school_esfuerzo <- proc_datos %>% dplyr::filter(curso_estudiante=="Básica") %>% 
  dplyr::select(school_esfuerzo_ES) #se filtran valores para esa categoría del curso
  
basica_school_esfuerzo = round(prop.table(table(categorias=basica_school_esfuerzo$school_esfuerzo_ES)),2) #se crean variables 'categoria' y 'Freq' del objeto

basica_school_esfuerzo = as.data.frame(basica_school_esfuerzo) #convertimos el objeto en data.frame

#basica_esfuerzo <- factor(basica_esfuerzo$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo")) #por ahora lo saltaré

plot_basica_school_esfuerzo<-ggplot(basica_school_esfuerzo,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes de básica") #graficamos


# dona curso: Media

# categoría media
media_school_esfuerzo <- proc_datos %>% filter(curso_estudiante=="Media") %>% 
  dplyr::select(school_esfuerzo_ES) 

media_school_esfuerzo = round(prop.table(table(categorias=media_school_esfuerzo$school_esfuerzo_ES)),2)  

media_school_esfuerzo = as.data.frame(media_school_esfuerzo)

plot_media_school_esfuerzo<-ggplot(media_school_esfuerzo,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes de media")
```

```{r, plot-school-esfuerzo, echo=FALSE}

#grafico esfuerzo en la escuela 


# Combinar los gráficos
school_esfuerzo <- ggarrange(
  plot_school_esfuerzo_ES, 
  plot_school_esfuerzo_AP,
  common.legend = TRUE, 
  ncol = 2, 
  legend = "none")

school_esfuerzo_curso <- ggarrange(
   plot_basica_school_esfuerzo, 
   plot_media_school_esfuerzo,
  common.legend = TRUE, 
 ncol = 2, 
  legend = "none")

school_esfuerzo_final <- ggarrange(
  school_esfuerzo,
  school_esfuerzo_curso,
  common.legend = TRUE, 
  nrow = 2, 
  legend = "bottom",
  legend.grob = get_legend(plot_school_esfuerzo_ES, "bottom"))

# Agregar una etiqueta global centrada
plot_school_esfuerzo_final <- annotate_figure(
  school_esfuerzo_final,
  top = text_grob(
    "Figura 1.23: En esta escuela, quienes se esfuerzan\nobtienen buenas notas",
    size = 12, 
    face = "italic", 
    color = "#8B7D7B",
    hjust = 0.5))


plot_school_esfuerzo_final

```

*Cruces con características sociodemográficas de estudiantes*

```{r, echo=FALSE}

frecuencias <- proc_datos_largo %>%
  group_by(variable, categoria, school_esfuerzo_ES) %>%
  summarise(Freq = n(), .groups = 'drop') %>%
  left_join(frecuencias_originales, by = c("variable", "categoria")) %>%
  mutate(Porcentaje = Freq / Freq_Original) %>%
  ungroup() %>% 
  na.omit()
# nombre facet_wrap
variable_names <- list("educ_max" = "Nivel educacional de los padres",
                       "genero_ES" = "Género",
                       "libros_hogar" = "Cantidad de libros en el hogar")
variable_labeller <- function(variable, value){return(variable_names[value])}

# Ajustar las etiquetas largas
frecuencias$categoria <- str_wrap(frecuencias$categoria, width = 10)

# Crear la gráfica
ggplot(frecuencias, aes(x = categoria, y = Porcentaje, fill = factor(school_esfuerzo_ES))) +
  geom_bar(stat = "identity", position = "fill", color = "white") +
  facet_wrap(~ variable, scales = "free_x", labeller = as_labeller(variable_labeller)) +
  geom_text(aes(label = scales::percent(Porcentaje, accuracy = 1)), 
            position = position_stack(vjust = 0.5), color = "black", size = 4.5) +
  labs(
    x = NULL, # Elimina el título del eje x
    y = NULL, # Elimina el título del eje y
    fill = "Grado de acuerdo",
    title = "Figura 1.24: En esta escuela, quienes se esfuerzan obtienen buenas notas"
  ) +
  theme_blank() +
  theme(
    axis.text.y = element_blank(),  # Ocultar etiquetas del eje y
    axis.ticks.y = element_blank(), # Ocultar marcas del eje y
    axis.title.x = element_blank(), # Ocultar título del eje x
    axis.title.y = element_blank(), # Ocultar título del eje y
    strip.text = element_text(size = 9, face = "bold"), # Ajustar tamaño y estilo del título de las facetas
    axis.text.x = element_text(size = 9), # Ajustar el tamaño de las etiquetas del eje x
    legend.position = "bottom",# Colocar la leyenda en la parte inferior
     plot.title = element_text(size = 12, face = "italic", color = "#8B7D7B")
  ) +
  scale_fill_brewer(palette = "Blues", 
                    labels = c("1" = "Muy en desacuerdo", "2" = "En desacuerdo", 
                               "3" = "De acuerdo", "4" = "Muy de acuerdo"),
                    name = NULL)
```

**Talento** en la escuela:

```{r, echo=FALSE}
# gráfico: talento y curso 

# dona curso: Básica

basica_school_talento <- proc_datos %>% dplyr::filter(curso_estudiante=="Básica") %>% 
  dplyr::select(school_talento_ES) #se filtran valores para esa categoría del curso
  
basica_school_talento = round(prop.table(table(categorias=basica_school_talento$school_talento_ES)),2) #se crean variables 'categoria' y 'Freq' del objeto

basica_school_talento = as.data.frame(basica_school_talento) #convertimos el objeto en data.frame

#basica_esfuerzo <- factor(basica_esfuerzo$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo")) #por ahora lo saltaré

plot_basica_school_talento<-ggplot(basica_school_talento,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes de básica") #graficamos


# dona curso: Media

# categoría media
media_school_talento <- proc_datos %>% filter(curso_estudiante=="Media") %>% 
  dplyr::select(school_talento_ES) 

media_school_talento = round(prop.table(table(categorias=media_school_talento$school_talento_ES)),2)  

media_school_talento = as.data.frame(media_school_talento)

plot_media_school_talento<-ggplot(media_school_talento,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes de media")
```

```{r, plot-school-talento, echo=FALSE}

# grafico talento en la escuela


# Combinar los gráficos
school_talento <- ggarrange(
  plot_school_talento_ES, 
  plot_school_talento_AP,
  common.legend = TRUE, 
  ncol = 2, 
  legend = "none")

school_talento_curso <- ggarrange(
   plot_basica_school_talento, 
   plot_media_school_talento,
  common.legend = TRUE, 
 ncol = 2, 
  legend = "none")

school_talento_final <- ggarrange(
  school_talento,
  school_talento_curso,
  common.legend = TRUE, 
  nrow = 2, 
  legend = "bottom",
  legend.grob = get_legend(plot_school_talento_ES, "bottom"))

# Agregar una etiqueta global centrada
plot_school_talento_final <- annotate_figure(
  school_talento_final,
  top = text_grob(
    "Figura 1.25: En esta escuela, quienes son inteligentes\nobtienen buenas notas",
    size = 12, 
    face = "italic", 
    color = "#8B7D7B",
    hjust = 0.5))


plot_school_talento_final
```

*Cruces con características sociodemográficas de estudiantes*

```{r, echo=FALSE}


frecuencias <- proc_datos_largo %>%
  group_by(variable, categoria, school_talento_ES) %>%
  summarise(Freq = n(), .groups = 'drop') %>%
  left_join(frecuencias_originales, by = c("variable", "categoria")) %>%
  mutate(Porcentaje = Freq / Freq_Original) %>%
  ungroup() %>% 
  na.omit()
# nombre facet_wrap
variable_names <- list("educ_max" = "Nivel educacional de los padres",
                       "genero_ES" = "Género",
                       "libros_hogar" = "Cantidad de libros en el hogar")
variable_labeller <- function(variable, value){return(variable_names[value])}

# Ajustar las etiquetas largas
frecuencias$categoria <- str_wrap(frecuencias$categoria, width = 10)

# Crear la gráfica
ggplot(frecuencias, aes(x = categoria, y = Porcentaje, fill = factor(school_talento_ES))) +
  geom_bar(stat = "identity", position = "fill", color = "white") +
  facet_wrap(~ variable, scales = "free_x", labeller = as_labeller(variable_labeller)) +
  geom_text(aes(label = scales::percent(Porcentaje, accuracy = 1)), 
            position = position_stack(vjust = 0.5), color = "black", size = 4.5) +
  labs(
    x = NULL, # Elimina el título del eje x
    y = NULL, # Elimina el título del eje y
    fill = "Grado de acuerdo",
    title = "Figura 1.26: En esta escuela, quienes son inteligentes obtienen buenas notas"
  ) +
  theme_blank() +
  theme(
    axis.text.y = element_blank(),  # Ocultar etiquetas del eje y
    axis.ticks.y = element_blank(), # Ocultar marcas del eje y
    axis.title.x = element_blank(), # Ocultar título del eje x
    axis.title.y = element_blank(), # Ocultar título del eje y
    strip.text = element_text(size = 9, face = "bold"), # Ajustar tamaño y estilo del título de las facetas
    axis.text.x = element_text(size = 9), # Ajustar el tamaño de las etiquetas del eje x
    legend.position = "bottom",# Colocar la leyenda en la parte inferior
     plot.title = element_text(size = 12, face = "italic", color = "#8B7D7B")
  ) +
  scale_fill_brewer(palette = "Blues", 
                    labels = c("1" = "Muy en desacuerdo", "2" = "En desacuerdo", 
                               "3" = "De acuerdo", "4" = "Muy de acuerdo"),
                    name = NULL)
```

Respecto al **mérito** en la escuela:

```{r, echo=FALSE}
# gráfico: merito y curso 

# dona curso: Básica

basica_school_merito <- proc_datos %>% dplyr::filter(curso_estudiante=="Básica") %>% 
  dplyr::select(school_merito_ES) #se filtran valores para esa categoría del curso
  
basica_school_merito = round(prop.table(table(categorias=basica_school_merito$school_merito_ES)),2) #se crean variables 'categoria' y 'Freq' del objeto

basica_school_merito = as.data.frame(basica_school_merito) #convertimos el objeto en data.frame

#basica_esfuerzo <- factor(basica_esfuerzo$categorias, levels = c(1, 2, 3, 4), labels = c("Muy en desacuerdo", "Desacuerdo", "De acuerdo", "Muy de acuerdo")) #por ahora lo saltaré

plot_basica_school_merito<-ggplot(basica_school_merito,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes de básica") #graficamos


# dona curso: Media

# categoría media
media_school_merito <- proc_datos %>% filter(curso_estudiante=="Media") %>% 
  dplyr::select(school_merito_ES) 

media_school_merito = round(prop.table(table(categorias=media_school_merito$school_merito_ES)),2)  

media_school_merito = as.data.frame(media_school_merito)

plot_media_school_merito<-ggplot(media_school_merito,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=12, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Estudiantes de media")
```

```{r, plot-school-merito, echo=FALSE}

# grafico merito en la escuela


# Combinar los gráficos
school_merito<- ggarrange(
  plot_school_merito_ES, 
  plot_school_merito_AP,
  common.legend = TRUE, 
  ncol = 2, 
  legend = "none")

school_merito_curso <- ggarrange(
   plot_basica_school_merito, 
   plot_media_school_merito,
  common.legend = TRUE, 
 ncol = 2, 
  legend = "none")

school_merito_final <- ggarrange(
  school_merito,
  school_merito_curso,
  common.legend = TRUE, 
  nrow = 2, 
  legend = "bottom",
  legend.grob = get_legend(plot_school_merito_ES, "bottom"))

# Agregar una etiqueta global centrada
plot_school_merito <- annotate_figure(
  school_merito_final,
  top = text_grob(
    "Figura 1.27: En esta escuela, los/as estudiantes obtienen\nlas notas que merecen",
    size = 12, 
    face = "italic", 
    color = "#8B7D7B",
    hjust = 0.5))


plot_school_merito
```

*Cruces con características sociodemográficas de estudiantes*

```{r, echo=FALSE}

frecuencias <- proc_datos_largo %>%
  group_by(variable, categoria, school_merito_ES) %>%
  summarise(Freq = n(), .groups = 'drop') %>%
  left_join(frecuencias_originales, by = c("variable", "categoria")) %>%
  mutate(Porcentaje = Freq / Freq_Original) %>%
  ungroup() %>% 
  na.omit()
# nombre facet_wrap
variable_names <- list("educ_max" = "Nivel educacional de los padres",
                       "genero_ES" = "Género",
                       "libros_hogar" = "Cantidad de libros en el hogar")
variable_labeller <- function(variable, value){return(variable_names[value])}

# Ajustar las etiquetas largas
frecuencias$categoria <- str_wrap(frecuencias$categoria, width = 10)

# Crear la gráfica
ggplot(frecuencias, aes(x = categoria, y = Porcentaje, fill = factor(school_merito_ES))) +
  geom_bar(stat = "identity", position = "fill", color = "white") +
  facet_wrap(~ variable, scales = "free_x", labeller = as_labeller(variable_labeller)) +
  geom_text(aes(label = scales::percent(Porcentaje, accuracy = 1)), 
            position = position_stack(vjust = 0.5), color = "black", size = 4.5) +
  labs(
    x = NULL, # Elimina el título del eje x
    y = NULL, # Elimina el título del eje y
    fill = "Grado de acuerdo",
    title = "Figura 1.28: En esta escuela, los/as estudiantes obtienen las notas que merecen"
  ) +
  theme_blank() +
  theme(
    axis.text.y = element_blank(),  # Ocultar etiquetas del eje y
    axis.ticks.y = element_blank(), # Ocultar marcas del eje y
    axis.title.x = element_blank(), # Ocultar título del eje x
    axis.title.y = element_blank(), # Ocultar título del eje y
    strip.text = element_text(size = 9, face = "bold"), # Ajustar tamaño y estilo del título de las facetas
    axis.text.x = element_text(size = 9), # Ajustar el tamaño de las etiquetas del eje x
    legend.position = "bottom",# Colocar la leyenda en la parte inferior
     plot.title = element_text(size = 12, face = "italic", color = "#8B7D7B")
  ) +
  scale_fill_brewer(palette = "Blues", 
                    labels = c("1" = "Muy en desacuerdo", "2" = "En desacuerdo", 
                               "3" = "De acuerdo", "4" = "Muy de acuerdo"),
                    name = NULL)
```

#### Preferencia

-   Respecto a criterios de mérito individual:

```{r, plot-curva-school-pref, echo=FALSE, warning=FALSE}

# gráfico de curva preferencia en la escuela  


#grafico 

school_merit_pref <- ggplot(data = proc_datos, 
       mapping = aes(x = school_merit_pref)) + 
  geom_density(color = "#4682b4", fill =  "White", alpha = 0.8, size = 0.7)  + 
  labs(x = "Preferencia de mérito en la escuela", 
       y = "Frecuencia" )  +
scale_y_percent() +
  scale_x_continuous(breaks = c(0, 5, 10), labels = c("Esfuerzo", "Ambos", "Talento")) +
  theme_classic() +
  ggtitle("Figura 1.29: Preferencia respecto al criterio individual de mérito más importante\npara obtener buenas notas") +
  theme(plot.title = element_text(size = 12,
    face = "italic", 
    color = "#8B7D7B", hjust = 0.5),
        plot.margin = margin(t = 20, r = 20, b = 20, l = 20))

school_merit_pref
```

Los estudiantes consideran que ambos criterios individuales son importantes para obtener buenas notas en la escuela con un 49%. Particularmente, se observa que un 10% cree que el talento es relevante y el 2% considera que el esfuerzo es importante para la obtención de buenas calficaciones.

### Justicia en las notas

En este apartado se observa la percepción de las/los estudiantes respecto a si la nota obtenida recompensa de manera justa su mérito individual. Posteriormente, se presenta de manera comparativa la nota que efectivamente estos recibieron y la preferencia que ellas/ellos tenían de la nota que debieron haber obtenido.

#### Percepciones

*a. Respecto a la justicia de la nota obtenida*

```{r, dona-notas-merito, echo=FALSE, warning=FALSE}
# grafico dona: nota y merecimiento

notas_merit = round(prop.table(table(categorias=proc_datos$notas_merit)),2)
notas_merit = as.data.frame(notas_merit)
notas_merit$categorias <- factor(notas_merit$categorias, levels = c(1, 2, 3), labels = c("Menos de lo que merezco", "Lo que merezco", "Más de lo que merezco"))
plot_notas_merit<-ggplot(notas_merit,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=10, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="¿Te parece que este promedio\nfue más o menos de lo\nque merecías?" )

# grafico dona: nota y esfuerzo 

notas_esfuerzo = round(prop.table(table(categorias=proc_datos$notas_esfuerzo)),2)
notas_esfuerzo = as.data.frame(notas_esfuerzo)
notas_esfuerzo$categorias <- factor(notas_esfuerzo$categorias, levels = c(1, 2, 3), labels = c("Menos de lo que merezco", "2.	Lo que merezco", "Más de lo que merezco"))
plot_notas_esfuerzo<-ggplot(notas_esfuerzo,aes(x=2,y=-Freq, fill=categorias))+
  geom_bar(stat = "identity", 
           color="white")+
    geom_text(aes(label = scales::percent(Freq)),
              position=position_stack(vjust=0.5),color="black",size=4.5)+
  coord_polar(theta = "y")+
  scale_fill_brewer(palette = "Blues")+
    theme_void()+
  theme(legend.title = element_blank(),
    plot.title = element_text(size=10, face="bold", hjust=0.5))+
  xlim(0.5,2.5) +
  labs(title="Tomando en cuenta el tiempo\nque le dedicas a tus estudios,\nlas notas que me saco son…" )
```

```{r , plot-notas-merito, echo=FALSE, warning=FALSE}
# Combinar los gráficos
plot_notas_merit<- ggarrange(
  plot_notas_merit, 
  plot_notas_esfuerzo,
  common.legend = TRUE, 
  ncol = 2, 
  legend = "bottom"
)

# Agregar una etiqueta global centrada
final_plot_notas_merit <- annotate_figure(
  plot_notas_merit,
  top = text_grob(
    "Figura 1.30: Merecimiento de la nota de acuerdo a criterios de mérito individual",
    size = 12, 
    face = "italic", 
    color = "#8B7D7B",
    hjust = 0.5
  )
)

final_plot_notas_merit # generamos el grafico
```

Los estudiantes consideran en un 78% que el promedio obtenido el año pasado es el que merecían, por ende, sus méritos son recompensados en su nota obtenida. Además, contestaron en un 71% que dichas notas son las que estos merecían de acuerdo al tiempo que le dedican a sus estudios, en ese sentido, su esfuerzo se ve recompensado en esa nota.

#### Notas del estudiante

Este apartado hace énfasis en la nota individual de la/el estudiante. De ese modo, se presenta comparativamente la *nota final que efectivamente obtuvo* y la *nota final que consideraba que debería haber obtenido*.

```{r, echo=FALSE, warning=FALSE, message=FALSE}

library(cowplot)

#grafico 

nota_ob <- ggplot(data = proc_datos, 
       mapping = aes(x = nota_obtenida)) + 
  geom_density(color = "#4682b4", fill =  "White", alpha = 0.8, linewidth = 0.7)  + 
  labs(x = "Nota", 
       y = "Frecuencia" )  +
scale_y_percent() +
  scale_y_continuous(labels = scales::percent, limits = c(0, 1)) +
  scale_x_continuous(breaks = 1:7) +
  expand_limits(x = c(1, 7))+
  theme_classic() +
  ggtitle("¿Cuál fue tu promedio de notas\nel año pasado?") +
  theme(plot.title = element_text(size = 9,
    face = "bold", 
    color = "black", hjust = 0.5),
        plot.margin = margin(t = 20, r = 20, b = 20, l = 20))

#grafico 
proc_datos_clean <- proc_datos[complete.cases(proc_datos$nota_pref), ]

nota_pref <- ggplot(data = proc_datos_clean, 
       mapping = aes(x = nota_pref)) +
  geom_density(color = "#BA55D3", fill =  "White", alpha = 0.8, linewidth = 0.7)  + 
  labs(x = "Nota", 
       y = "Frecuencia" )  +
scale_y_percent() +
  scale_y_continuous(labels = scales::percent, limits = c(0, 1)) +
  scale_x_continuous(breaks = 1:7) +
  expand_limits(x = c(1, 7))+
  theme_classic() +
  ggtitle("En caso que tu promedio no es lo que merecías\n¿Qué promedio piensas que merecías?") +
  theme(plot.title = element_text(size = 9,
    face = "bold", 
    color = "black", hjust = 0.5),
        plot.margin = margin(t = 20, r = 20, b = 20, l = 20)) 



# Combinar los gráficos usando plot_grid
combined_plot <- cowplot::plot_grid(nota_ob, nota_pref)


combined_plot <- annotate_figure(
  combined_plot,
  top = text_grob(
    "Figura 1.31: Contraste entre la nota obtenida y la nota preferida\npor el estudiante",
    size = 12, 
    face = "italic", 
    color = "#8B7D7B",
    hjust = 0.5))
combined_plot
```
